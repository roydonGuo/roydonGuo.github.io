<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>node.js | roydon</title><meta name="keywords" content="jsonp,cors,Node.js,session,JWT,æœåŠ¡"><meta name="author" content="roydon,3133010060@qq.com"><meta name="copyright" content="roydon"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="noticeï¼š    åŸºç¡€ç¯‡ï¼Œå…·ä½“è®²è§£æ¨¡å—åŒ–éƒ¨åˆ†å†…å®¹ï¼Œè·¯ç”±æ¨¡å—ï¼Œå†™æ¥å£ï¼Œæ•°æ®åº“ï¼ŒJWT   å‰æÂ·éœ€è¦æŒæ¡    Node.js  is a JavaScript runtime built on Chromeâ€™s V8 JavaScript engine.Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚ Node.js çš„å®˜ç½‘åœ°å€ï¼š https:&#x2F;&#x2F;nod">
<meta property="og:type" content="article">
<meta property="og:title" content="node.js">
<meta property="og:url" content="https://blog.roydon.site/posts/node.js.html">
<meta property="og:site_name" content="roydon">
<meta property="og:description" content="noticeï¼š    åŸºç¡€ç¯‡ï¼Œå…·ä½“è®²è§£æ¨¡å—åŒ–éƒ¨åˆ†å†…å®¹ï¼Œè·¯ç”±æ¨¡å—ï¼Œå†™æ¥å£ï¼Œæ•°æ®åº“ï¼ŒJWT   å‰æÂ·éœ€è¦æŒæ¡    Node.js  is a JavaScript runtime built on Chromeâ€™s V8 JavaScript engine.Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚ Node.js çš„å®˜ç½‘åœ°å€ï¼š https:&#x2F;&#x2F;nod">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://bu.dusays.com/2022/11/17/6375f87e21b29.png">
<meta property="article:published_time" content="2022-08-30T13:14:00.000Z">
<meta property="article:modified_time" content="2022-08-30T18:14:00.000Z">
<meta property="article:author" content="roydon">
<meta property="article:tag" content="jsonp">
<meta property="article:tag" content="cors">
<meta property="article:tag" content="Node.js">
<meta property="article:tag" content="session">
<meta property="article:tag" content="JWT">
<meta property="article:tag" content="æœåŠ¡">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://bu.dusays.com/2022/11/17/6375f87e21b29.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://blog.roydon.site/posts/node.js"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"X0C9B1Y395","apiKey":"647945f168ebe35551ed4db649f294a7","indexName":"roydon","hits":{"per_page":10},"languages":{"input_placeholder":"æœç´¢æ–‡ç« ","hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼Œç”¨æ—¶ ${time} æ¯«ç§’"}},
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":250},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: 'å¤©',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: {"limitCount":50,"languages":{"author":"ä½œè€…: roydon","link":"é“¾æ¥: ","source":"æ¥æº: roydon","info":"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"ä½ å·²åˆ‡æ¢ä¸ºç¹ä½“","cht_to_chs":"ä½ å·²åˆ‡æ¢ä¸ºç®€ä½“","day_to_night":"ä½ å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"ä½ å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"pink","bgDark":"rgba(0, 0, 0, 0.8)","position":"top-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'node.js',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-08-30 18:14:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="//at.alicdn.com/t/c/font_3603575_clr3kjixtq6.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_3724351_hmmm4fjv1tc.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_3603575_qwu8r542qo9.css"><link rel="stylesheet" href="/css/spine.css"><link rel="stylesheet" href="/css/roydon.css"><link rel="stylesheet" href="/css/music.css"><link rel="stylesheet" href="/log/log.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css"><link rel="stylesheet" href="https://unpkg.com/swiper@8/swiper-bundle.min.css"><script defer src="https://cdn.cbd.int/jquery@latest/dist/jquery.min.js"></script><script defer src="/log/live2d.min.js"></script><script defer src="/log/live2dcubismcore.min.js"></script><div id="myscoll"></div><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="roydon" type="application/atom+xml">
</head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><div id="web_bg"></div><div id="an_music_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/roydonGuo/CDN/avatar/avatar-cat.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">43</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">47</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">11</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon--article"></i><span> æ–‡ç« </span></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw iconfont icon-guidang"></i><span> å½’æ¡£</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw iconfont icon-categories"></i><span> åˆ†ç±»</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw iconfont icon-tags"></i><span> æ ‡ç­¾</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon-resources"></i><span> èµ„æº</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/projects/"><i class="fa-fw iconfont icon-projects"></i><span> é¡¹ç›®</span></a></li><li><a class="site-page child" href="/bagu/"><i class="fa-fw iconfont icon-projects"></i><span> å…«è‚¡</span></a></li><li><a class="site-page child" href="/tutorial/"><i class="fa-fw iconfont icon-projects"></i><span> æ•™ç¨‹</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon-yulezhongxin"></i><span> å¨±ä¹</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/Gallery/"><i class="fa-fw iconfont icon-xiangce"></i><span> ç›¸å†Œ</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw iconfont icon-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw iconfont icon-dianying"></i><span> ç”µå½±</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon-kafei"></i><span> ä¼‘é—²</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/animation/"><i class="fa-fw iconfont icon-anima"></i><span> åŠ¨ç”»</span></a></li><li><a class="site-page child" href="/demo/"><i class="fa-fw iconfont icon-demo"></i><span> è¯•éªŒ</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw iconfont icon-game"></i><span> æ¸¸æˆ</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon-xin"></i><span> äº¤å‹</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/comments/"><i class="fa-fw iconfont icon-pinglun"></i><span> ç•™è¨€</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw iconfont icon-links"></i><span> å‹é“¾</span></a></li><li><a class="site-page child" href="/fcircle/"><i class="fa-fw iconfont icon-guanzhu"></i><span> å…³æ³¨</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon-shenghuo"></i><span> ç”Ÿæ´»</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/bangumis/"><i class="fa-fw iconfont icon-bilibili"></i><span> è¿½ç•ª</span></a></li><li><a class="site-page child" href="/essay/"><i class="fa-fw iconfont icon-bibi"></i><span> å“”å“”</span></a></li><li><a class="site-page child" href="/tools/"><i class="fa-fw iconfont icon-ziyuan"></i><span> å·¥å…·</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon-wangluo"></i><span> æœ¬ç«™</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/log/"><i class="fa-fw iconfont icon-calendar"></i><span> æ—¥å¿—</span></a></li><li><a class="site-page child" href="/stats/"><i class="fa-fw iconfont icon-stats"></i><span> ç»Ÿè®¡</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw iconfont icon-kaixin"></i><span> å…³äº</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div class="nav_group" id="nav_group"><div id="blog_name"><div class="list-button"><i class="fas fa-grip-vertical"></i><div class="list-content"><div class="list-content-group"><div class="group-title">æ¨èâœ¨</div><div class="list-box"><a class="box-item" href="https://github.com/roydonGuo" rel="external nofollow" title="Github" target="_blank" one-link-mark="yes"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/11/17/6375f3b3c7075.png"/><span>Github</span></a><a class="box-item" href="https://gitee.com/guo-yc" rel="external nofollow" title="Gitee" target="_blank" one-link-mark="yes"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/11/17/6375f4abe21a9.png"/><span>Gitee</span></a><a class="box-item" href="https://blog.csdn.net/m0_51390535" rel="external nofollow" title="CSDN" target="_blank" one-link-mark="yes"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/11/17/6375f3b3bb6f4.png"/><span>CSDN</span></a></div></div><div class="list-content-group"><div class="group-title">é¡¹ç›®ğŸ”…</div><div class="list-box"><a class="box-item" href="https://github.com/roydonGuo/WeatherForcast4" title="" target="_blank" rel="noopener nofollow" one-link-mark="yes"><img class="entered exited" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/11/17/6375f3b3bcf65.png"/><span>å¤©æ°”é¢„æŠ¥APP</span></a><a class="box-item" href="https://github.com/gcb1120/google2022/tree/develop" title="" target="_blank" rel="noopener nofollow" one-link-mark="yes"><img class="entered exited" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/11/17/6375f3b3c75d9.png"/><span>Google2022</span></a></div></div></div></div><a id="site-name" href="javascript:;" onclick="pjax.loadUrl(&quot;/&quot;)">roydon</a></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon--article"></i><span> æ–‡ç« </span></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw iconfont icon-guidang"></i><span> å½’æ¡£</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw iconfont icon-categories"></i><span> åˆ†ç±»</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw iconfont icon-tags"></i><span> æ ‡ç­¾</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon-resources"></i><span> èµ„æº</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/projects/"><i class="fa-fw iconfont icon-projects"></i><span> é¡¹ç›®</span></a></li><li><a class="site-page child" href="/bagu/"><i class="fa-fw iconfont icon-projects"></i><span> å…«è‚¡</span></a></li><li><a class="site-page child" href="/tutorial/"><i class="fa-fw iconfont icon-projects"></i><span> æ•™ç¨‹</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon-yulezhongxin"></i><span> å¨±ä¹</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/Gallery/"><i class="fa-fw iconfont icon-xiangce"></i><span> ç›¸å†Œ</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw iconfont icon-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw iconfont icon-dianying"></i><span> ç”µå½±</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon-kafei"></i><span> ä¼‘é—²</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/animation/"><i class="fa-fw iconfont icon-anima"></i><span> åŠ¨ç”»</span></a></li><li><a class="site-page child" href="/demo/"><i class="fa-fw iconfont icon-demo"></i><span> è¯•éªŒ</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw iconfont icon-game"></i><span> æ¸¸æˆ</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon-xin"></i><span> äº¤å‹</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/comments/"><i class="fa-fw iconfont icon-pinglun"></i><span> ç•™è¨€</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw iconfont icon-links"></i><span> å‹é“¾</span></a></li><li><a class="site-page child" href="/fcircle/"><i class="fa-fw iconfont icon-guanzhu"></i><span> å…³æ³¨</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon-shenghuo"></i><span> ç”Ÿæ´»</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/bangumis/"><i class="fa-fw iconfont icon-bilibili"></i><span> è¿½ç•ª</span></a></li><li><a class="site-page child" href="/essay/"><i class="fa-fw iconfont icon-bibi"></i><span> å“”å“”</span></a></li><li><a class="site-page child" href="/tools/"><i class="fa-fw iconfont icon-ziyuan"></i><span> å·¥å…·</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon-wangluo"></i><span> æœ¬ç«™</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/log/"><i class="fa-fw iconfont icon-calendar"></i><span> æ—¥å¿—</span></a></li><li><a class="site-page child" href="/stats/"><i class="fa-fw iconfont icon-stats"></i><span> ç»Ÿè®¡</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw iconfont icon-kaixin"></i><span> å…³äº</span></a></li></ul></div></div></div><div id="buttons"><div id="search-button"><a class="site-page-to social-icon search" title="æœç´¢æ–‡ç« "><i class="iconfont icon-sousuo fa-fw"></i></a></div><div id="console"><a class="site-page-to social-icon search" href="javascript:;" onclick="toggleWinbox()" title="æ‰“å¼€åŠŸèƒ½çª—å£"><i class="iconfont icon-pc"></i></a></div><div id="switch-theme"><a class="site-page-to social-icon search" href="javascript:;" onclick="roydon.switchNightMode()" title="åˆ‡æ¢ä¸»é¢˜"><i class="iconfont icon-taiyang" id="dark-theme-coin"></i></a></div><div id="toggle-menu"> <a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></div></nav><div id="post-info"><h1 class="post-title">node.js</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label"></span><time class="post-meta-date-created" datetime="2022-08-30T13:14:00.000Z" title=" 2022-08-30 13:14:00">2022-08-30</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label"></span><time class="post-meta-date-updated" datetime="2022-08-30T18:14:00.000Z" title=" 2022-08-30 18:14:00">2022-08-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF/">å‰ç«¯</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">11.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>44åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="node.js"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|&nbsp<span class="post-meta-dianzan"><a class="dianzan" href="javascript:void(0)" onclick="dianzan()"><i class="iconfont icon-dianzan"></i><span class="post-meta-label"> ç‚¹èµ:</span><span class="dianzan-count">0</span></a></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><div class="note pink icon-padding modern"><i class="note-icon fas fa-bullhorn"></i><p>noticeï¼š<br>    <mark class="hl-label pink">åŸºç¡€ç¯‡ï¼Œå…·ä½“è®²è§£æ¨¡å—åŒ–éƒ¨åˆ†å†…å®¹ï¼Œè·¯ç”±æ¨¡å—ï¼Œå†™æ¥å£ï¼Œæ•°æ®åº“ï¼ŒJWT</mark> </p>
</div>
<p>å‰æÂ·éœ€è¦æŒæ¡</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img1.imgtp.com/2022/08/30/fRNUYiRe.png" alt="image-20220809172613764"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img1.imgtp.com/2022/08/30/53tYZlGe.png" alt="image-20220809172800095"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img1.imgtp.com/2022/08/30/YAvi2ZFf.png" alt="image-20220809173304478"></p>
<p>Node.js  is a JavaScript runtime built on Chromeâ€™s V8 JavaScript engine.<br>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚</p>
<p>Node.js çš„å®˜ç½‘åœ°å€ï¼š <a target="_blank" rel="noopener" href="https://nodejs.org/zh-cn/">https://nodejs.org/zh-cn/</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img1.imgtp.com/2022/08/30/xvMDcCOL.png" alt="image-20220809173543073"></p>
<ul>
<li>æµè§ˆå™¨æ˜¯ JavaScript çš„å‰ç«¯è¿è¡Œç¯å¢ƒã€‚</li>
<li>Node.js æ˜¯ JavaScript çš„åç«¯è¿è¡Œç¯å¢ƒã€‚Node.js ä¸­æ— æ³•è°ƒç”¨ DOM å’Œ BOM ç­‰æµè§ˆå™¨å†…ç½® APIã€‚</li>
</ul>
<p>ä½¿ç”¨ tab é”®ï¼Œèƒ½å¤Ÿå¿«é€Ÿè¡¥å…¨è·¯å¾„<br>ä½¿ç”¨ esc é”®ï¼Œèƒ½å¤Ÿå¿«é€Ÿæ¸…ç©ºå½“å‰å·²è¾“å…¥çš„å‘½ä»¤<br>è¾“å…¥ cls å‘½ä»¤ï¼Œå¯ä»¥æ¸…ç©ºç»ˆç«¯</p>
<h1 id="fs-æ–‡ä»¶ç³»ç»Ÿæ¨¡å—"><a href="#fs-æ–‡ä»¶ç³»ç»Ÿæ¨¡å—" class="headerlink" title="fs æ–‡ä»¶ç³»ç»Ÿæ¨¡å—"></a>fs æ–‡ä»¶ç³»ç»Ÿæ¨¡å—</h1><p>fs æ¨¡å—æ˜¯ Node.js å®˜æ–¹æä¾›çš„ã€ç”¨æ¥æ“ä½œæ–‡ä»¶çš„æ¨¡å—ã€‚å®ƒæä¾›äº†ä¸€ç³»åˆ—çš„æ–¹æ³•å’Œå±æ€§ï¼Œç”¨æ¥æ»¡è¶³ç”¨æˆ·å¯¹æ–‡ä»¶çš„æ“ä½œéœ€æ±‚ã€‚<br>ä¾‹å¦‚ï¼š</p>
<ul>
<li><strong>fs.readFile()</strong> æ–¹æ³•ï¼Œç”¨æ¥è¯»å–æŒ‡å®šæ–‡ä»¶ä¸­çš„å†…å®¹</li>
<li><strong>fs.writeFile()</strong> æ–¹æ³•ï¼Œç”¨æ¥å‘æŒ‡å®šçš„æ–‡ä»¶ä¸­å†™å…¥å†…å®¹ </li>
</ul>
<p>å¦‚æœè¦åœ¨ JavaScript ä»£ç ä¸­ï¼Œä½¿ç”¨ fs æ¨¡å—æ¥æ“ä½œæ–‡ä»¶ï¼Œåˆ™éœ€è¦ä½¿ç”¨å¦‚ä¸‹çš„æ–¹å¼å…ˆå¯¼å…¥å®ƒï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="1-fs-readFile-çš„è¯­æ³•æ ¼å¼"><a href="#1-fs-readFile-çš„è¯­æ³•æ ¼å¼" class="headerlink" title="1. fs.readFile() çš„è¯­æ³•æ ¼å¼"></a>1. fs.readFile() çš„è¯­æ³•æ ¼å¼</h2><p>ä½¿ç”¨ fs.readFile() æ–¹æ³•ï¼Œå¯ä»¥è¯»å–æŒ‡å®šæ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œè¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.<span class="title function_">readFile</span>(path,[options,]callback)</span><br></pre></td></tr></table></figure></p>
<p>å‚æ•°è§£è¯»ï¼š</p>
<ul>
<li>å‚æ•°1ï¼šå¿…é€‰å‚æ•°ï¼Œå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ–‡ä»¶çš„è·¯å¾„ã€‚</li>
<li>å‚æ•°2ï¼šå¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºä»¥ä»€ä¹ˆç¼–ç æ ¼å¼æ¥è¯»å–æ–‡ä»¶ã€‚</li>
<li>å‚æ•°3ï¼šå¿…é€‰å‚æ•°ï¼Œæ–‡ä»¶è¯»å–å®Œæˆåï¼Œé€šè¿‡å›è°ƒå‡½æ•°æ‹¿åˆ°è¯»å–çš„ç»“æœã€‚</li>
</ul>
<h2 id="2-fs-writeFile-çš„è¯­æ³•æ ¼å¼"><a href="#2-fs-writeFile-çš„è¯­æ³•æ ¼å¼" class="headerlink" title="2. fs.writeFile() çš„è¯­æ³•æ ¼å¼"></a>2. fs.writeFile() çš„è¯­æ³•æ ¼å¼</h2><p>ä½¿ç”¨ fs.writeFile() æ–¹æ³•ï¼Œå¯ä»¥å‘æŒ‡å®šçš„æ–‡ä»¶ä¸­å†™å…¥å†…å®¹ï¼Œè¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.<span class="title function_">writeFile</span>(file,data,[options,]callback)</span><br></pre></td></tr></table></figure></p>
<p>å‚æ•°è§£è¯»ï¼š</p>
<ul>
<li>å‚æ•°1ï¼šå¿…é€‰å‚æ•°ï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªæ–‡ä»¶è·¯å¾„çš„å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ–‡ä»¶çš„å­˜æ”¾è·¯å¾„ã€‚</li>
<li>å‚æ•°2ï¼šå¿…é€‰å‚æ•°ï¼Œè¡¨ç¤ºè¦å†™å…¥çš„å†…å®¹ã€‚</li>
<li>å‚æ•°3ï¼šå¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºä»¥ä»€ä¹ˆæ ¼å¼å†™å…¥æ–‡ä»¶å†…å®¹ï¼Œé»˜è®¤å€¼æ˜¯ utf8ã€‚</li>
<li>å‚æ•°4ï¼šå¿…é€‰å‚æ•°ï¼Œæ–‡ä»¶å†™å…¥å®Œæˆåçš„å›è°ƒå‡½æ•°ã€‚</li>
</ul>
<p>==è·¯å¾„åŠ¨æ€æ‹¼æ¥çš„é—®é¢˜==</p>
<p>åœ¨ä½¿ç”¨ fs æ¨¡å—æ“ä½œæ–‡ä»¶æ—¶ï¼Œå¦‚æœæä¾›çš„æ“ä½œè·¯å¾„æ˜¯ä»¥ ./ æˆ– ../ å¼€å¤´çš„ç›¸å¯¹è·¯å¾„æ—¶ï¼Œå¾ˆå®¹æ˜“å‡ºç°è·¯å¾„åŠ¨æ€æ‹¼æ¥é”™è¯¯çš„é—®é¢˜ã€‚<br>åŸå› ï¼šä»£ç åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œä¼šä»¥æ‰§è¡Œ node å‘½ä»¤æ—¶æ‰€å¤„çš„ç›®å½•ï¼ŒåŠ¨æ€æ‹¼æ¥å‡ºè¢«æ“ä½œæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ã€‚<br>è§£å†³æ–¹æ¡ˆï¼šåœ¨ä½¿ç”¨ fs æ¨¡å—æ“ä½œæ–‡ä»¶æ—¶ï¼Œç›´æ¥æä¾›å®Œæ•´çš„è·¯å¾„ï¼Œä¸è¦æä¾› ./ æˆ– ../ å¼€å¤´çš„ç›¸å¯¹è·¯å¾„ï¼Œä»è€Œé˜²æ­¢è·¯å¾„åŠ¨æ€æ‹¼æ¥çš„é—®é¢˜ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡ºç°è·¯å¾„æ‹¼æ¥é”™è¯¯çš„é—®é¢˜ï¼Œæ˜¯å› ä¸ºæä¾›äº† ./ æˆ– ../ å¼€å¤´çš„ç›¸å¯¹è·¯å¾„</span></span><br><span class="line"><span class="comment">// å¦‚æœè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ç›´æ¥æä¾›ä¸€ä¸ªå®Œæ•´çš„æ–‡ä»¶å­˜æ”¾è·¯å¾„å°±è¡Œ</span></span><br><span class="line">fs.<span class="title function_">readFile</span>(<span class="string">&#x27;./files/1.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="keyword">function</span>(<span class="params">err, dataStr</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¯»å–æ–‡ä»¶å¤±è´¥ï¼&#x27;</span> + err.<span class="property">message</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¯»å–æ–‡ä»¶æˆåŠŸï¼&#x27;</span> + dataStr)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç§»æ¤æ€§éå¸¸å·®ã€ä¸åˆ©äºç»´æŠ¤</span></span><br><span class="line">fs.<span class="title function_">readFile</span>(<span class="string">&#x27;C:\\Users\\31330\\Desktop\\nodejs\\code\\files\\1.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="keyword">function</span>(<span class="params">err, dataStr</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¯»å–æ–‡ä»¶å¤±è´¥ï¼&#x27;</span> + err.<span class="property">message</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¯»å–æ–‡ä»¶æˆåŠŸï¼&#x27;</span> + dataStr)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// __dirname è¡¨ç¤ºå½“å‰æ–‡ä»¶æ‰€å¤„çš„ç›®å½•</span></span><br><span class="line"><span class="comment">// console.log(__dirname)</span></span><br><span class="line"></span><br><span class="line">fs.<span class="title function_">readFile</span>(__dirname + <span class="string">&#x27;/files/1.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="keyword">function</span>(<span class="params">err, dataStr</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¯»å–æ–‡ä»¶å¤±è´¥ï¼&#x27;</span> + err.<span class="property">message</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¯»å–æ–‡ä»¶æˆåŠŸï¼&#x27;</span> + dataStr)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h1 id="path-è·¯å¾„æ¨¡å—"><a href="#path-è·¯å¾„æ¨¡å—" class="headerlink" title="path è·¯å¾„æ¨¡å—"></a>path è·¯å¾„æ¨¡å—</h1><p>path æ¨¡å—æ˜¯ Node.js å®˜æ–¹æä¾›çš„ã€ç”¨æ¥å¤„ç†è·¯å¾„çš„æ¨¡å—ã€‚å®ƒæä¾›äº†ä¸€ç³»åˆ—çš„æ–¹æ³•å’Œå±æ€§ï¼Œç”¨æ¥æ»¡è¶³ç”¨æˆ·å¯¹è·¯å¾„çš„å¤„ç†éœ€æ±‚ã€‚<br>ä¾‹å¦‚ï¼š</p>
<ul>
<li><strong>path.join() </strong>æ–¹æ³•ï¼Œç”¨æ¥å°†å¤šä¸ªè·¯å¾„ç‰‡æ®µæ‹¼æ¥æˆä¸€ä¸ªå®Œæ•´çš„è·¯å¾„å­—ç¬¦ä¸² </li>
<li><strong>path.basename()</strong> æ–¹æ³•ï¼Œç”¨æ¥ä»è·¯å¾„å­—ç¬¦ä¸²ä¸­ï¼Œå°†æ–‡ä»¶åè§£æå‡ºæ¥</li>
</ul>
<p>å¦‚æœè¦åœ¨ JavaScript ä»£ç ä¸­ï¼Œä½¿ç”¨ path æ¨¡å—æ¥å¤„ç†è·¯å¾„ï¼Œåˆ™éœ€è¦ä½¿ç”¨å¦‚ä¸‹çš„æ–¹å¼å…ˆå¯¼å…¥å®ƒï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="1-path-join-çš„è¯­æ³•æ ¼å¼"><a href="#1-path-join-çš„è¯­æ³•æ ¼å¼" class="headerlink" title="1. path.join() çš„è¯­æ³•æ ¼å¼"></a>1. path.join() çš„è¯­æ³•æ ¼å¼</h2><p>ä½¿ç”¨ path.join() æ–¹æ³•ï¼Œå¯ä»¥æŠŠå¤šä¸ªè·¯å¾„ç‰‡æ®µæ‹¼æ¥ä¸ºå®Œæ•´çš„è·¯å¾„å­—ç¬¦ä¸²ï¼Œè¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path.<span class="title function_">join</span>([...paths])</span><br></pre></td></tr></table></figure></p>
<p>å‚æ•°è§£è¯»ï¼š</p>
<ul>
<li>â€¦paths <string> è·¯å¾„ç‰‡æ®µçš„åºåˆ—</li>
<li>è¿”å›å€¼: <string></li>
</ul>
<p>ä½¿ç”¨ path.join() æ–¹æ³•ï¼Œå¯ä»¥æŠŠå¤šä¸ªè·¯å¾„ç‰‡æ®µæ‹¼æ¥ä¸ºå®Œæ•´çš„è·¯å¾„å­—ç¬¦ä¸²ï¼š</p>
<blockquote>
<p>æ³¨æ„ï¼š â€˜../â€˜  è¡¨ç¤ºå›é€€ä¸€å±‚è·¯å¾„</p>
<p>æ¶‰åŠåˆ°è·¯å¾„æ‹¼æ¥çš„æ“ä½œï¼Œéƒ½è¦ä½¿ç”¨ path.join() æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚ä¸è¦ç›´æ¥ä½¿ç”¨ + è¿›è¡Œå­—ç¬¦ä¸²çš„æ‹¼æ¥ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨æ„ï¼š  ../ ä¼šæŠµæ¶ˆå‰é¢çš„è·¯å¾„</span></span><br><span class="line"><span class="keyword">const</span> pathStr = path.<span class="title function_">join</span>(<span class="string">&#x27;/a&#x27;</span>, <span class="string">&#x27;/b/c&#x27;</span>, <span class="string">&#x27;../../&#x27;</span>, <span class="string">&#x27;./d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(pathStr)  <span class="comment">// \a\b\d\e</span></span><br><span class="line"></span><br><span class="line">fs.<span class="title function_">readFile</span>(__dirname + <span class="string">&#x27;/files/1.txt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">fs.<span class="title function_">readFile</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;./files/1.txt&#x27;</span>), <span class="string">&#x27;utf8&#x27;</span>, <span class="keyword">function</span>(<span class="params">err, dataStr</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">message</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(dataStr) <span class="comment">//å½“å‰æ–‡ä»¶æ‰€åœ¨ç›®å½•\files\1.txt</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="2-path-basename-çš„è¯­æ³•æ ¼å¼"><a href="#2-path-basename-çš„è¯­æ³•æ ¼å¼" class="headerlink" title="2. path.basename() çš„è¯­æ³•æ ¼å¼"></a>2. path.basename() çš„è¯­æ³•æ ¼å¼</h2><p>ä½¿ç”¨ path.basename() æ–¹æ³•ï¼Œå¯ä»¥è·å–è·¯å¾„ä¸­çš„æœ€åä¸€éƒ¨åˆ†ï¼Œç»å¸¸é€šè¿‡è¿™ä¸ªæ–¹æ³•è·å–è·¯å¾„ä¸­çš„æ–‡ä»¶åï¼Œè¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path.<span class="title function_">basename</span>(path[,ext])</span><br></pre></td></tr></table></figure></p>
<p>å‚æ•°è§£è¯»ï¼š</p>
<ul>
<li>path <string> å¿…é€‰å‚æ•°ï¼Œè¡¨ç¤ºä¸€ä¸ªè·¯å¾„çš„å­—ç¬¦ä¸² </li>
<li>ext <string> å¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºæ–‡ä»¶æ‰©å±•å</li>
<li>è¿”å›: <string> è¡¨ç¤ºè·¯å¾„ä¸­çš„æœ€åä¸€éƒ¨åˆ†</li>
</ul>
<p>ä½¿ç”¨ path.basename() æ–¹æ³•ï¼Œå¯ä»¥ä»ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ä¸­ï¼Œè·å–åˆ°æ–‡ä»¶çš„åç§°éƒ¨åˆ†ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fpath = <span class="string">&#x27;a/b/c/index.html&#x27;</span> <span class="comment">// æ–‡ä»¶å­˜æ”¾è·¯å¾„</span></span><br><span class="line"><span class="keyword">var</span> fullName = path.<span class="title function_">basename</span>(fpath)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fullName) <span class="comment">// è¾“å‡º index.html</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> nameWithoutExt = path.<span class="title function_">basename</span>(fpath,<span class="string">&#x27;.html&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fullName) <span class="comment">// è¾“å‡º index</span></span><br></pre></td></tr></table></figure></p>
<h2 id="3-path-extname-çš„è¯­æ³•æ ¼å¼"><a href="#3-path-extname-çš„è¯­æ³•æ ¼å¼" class="headerlink" title="3. path.extname() çš„è¯­æ³•æ ¼å¼"></a>3. path.extname() çš„è¯­æ³•æ ¼å¼</h2><p>ä½¿ç”¨ path.extname() æ–¹æ³•ï¼Œå¯ä»¥è·å–è·¯å¾„ä¸­çš„æ‰©å±•åéƒ¨åˆ†ï¼Œè¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path.<span class="title function_">extname</span>(path)</span><br></pre></td></tr></table></figure></p>
<p>å‚æ•°è§£è¯»ï¼š</p>
<ul>
<li>path <string>å¿…é€‰å‚æ•°ï¼Œè¡¨ç¤ºä¸€ä¸ªè·¯å¾„çš„å­—ç¬¦ä¸²</li>
<li>è¿”å›: <string> è¿”å›å¾—åˆ°çš„æ‰©å±•åå­—ç¬¦ä¸²</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fpath = <span class="string">&#x27;a/b/c/index.html&#x27;</span> <span class="comment">// æ–‡ä»¶å­˜æ”¾è·¯å¾„</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fext = path.<span class="title function_">extname</span>(fpath)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fullName) <span class="comment">// è¾“å‡º .html</span></span><br></pre></td></tr></table></figure>
<hr>
<h1 id="http-æ¨¡å—"><a href="#http-æ¨¡å—" class="headerlink" title="http æ¨¡å—"></a>http æ¨¡å—</h1><p>http æ¨¡å—æ˜¯ Node.js å®˜æ–¹æä¾›çš„ã€ç”¨æ¥åˆ›å»º web æœåŠ¡å™¨çš„æ¨¡å—ã€‚</p>
<p>é€šè¿‡ http æ¨¡å—æä¾›çš„<code>http.createServer()</code>æ–¹æ³•ï¼Œå°±èƒ½æ–¹ä¾¿çš„æŠŠä¸€å°ç”µè„‘å˜æˆWeb æœåŠ¡å™¨ï¼Œä»è€Œå¯¹å¤–æä¾› Web èµ„æºæœåŠ¡ã€‚</p>
<h2 id="1-åˆ›å»ºåŸºæœ¬çš„-web-æœåŠ¡å™¨"><a href="#1-åˆ›å»ºåŸºæœ¬çš„-web-æœåŠ¡å™¨" class="headerlink" title="1.åˆ›å»ºåŸºæœ¬çš„ web æœåŠ¡å™¨"></a>1.åˆ›å»ºåŸºæœ¬çš„ web æœåŠ¡å™¨</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. å¯¼å…¥ http æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="comment">// 2. åˆ›å»º web æœåŠ¡å™¨å®ä¾‹</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>()</span><br><span class="line"><span class="comment">// 3. æœåŠ¡å™¨å®ä¾‹ç»‘å®š request äº‹ä»¶ï¼Œç›‘å¬å®¢æˆ·ç«¯çš„è¯·æ±‚</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;request&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Someone visit our web server.&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 4. å¯åŠ¨æœåŠ¡å™¨</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">8080</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;  </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;server running at http://127.0.0.1:8080&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="req-è¯·æ±‚å¯¹è±¡"><a href="#req-è¯·æ±‚å¯¹è±¡" class="headerlink" title="req è¯·æ±‚å¯¹è±¡"></a>req è¯·æ±‚å¯¹è±¡</h3><p>åªè¦å®¢æˆ·ç«¯è®¿é—®äº†æœåŠ¡å™¨ç›‘å¬çš„åœ°å€ï¼ŒæœåŠ¡å™¨æ¥æ”¶åˆ°äº†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå°±ä¼šè°ƒç”¨é€šè¿‡ <code>server.on()</code> ä¸ºæœåŠ¡å™¨ç»‘å®šçš„ request äº‹ä»¶å¤„ç†å‡½æ•°ã€‚</p>
<p>é€šè¿‡å‡½æ•°çš„ req å‚æ•°å¯ä»¥è®¿é—®ä¸==å®¢æˆ·ç«¯==ç›¸å…³çš„æ•°æ®æˆ–å±æ€§ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// req.url æ˜¯å®¢æˆ·ç«¯è¯·æ±‚çš„ URL åœ°å€ã€‚req.method æ˜¯å®¢æˆ·ç«¯è¯·æ±‚çš„ method ç±»å‹</span></span><br><span class="line">  <span class="keyword">const</span> str = <span class="string">`Your request url is <span class="subst">$&#123;req.url&#125;</span>, and request method is <span class="subst">$&#123;req.method&#125;</span>`</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(str)</span><br><span class="line">  <span class="comment">// è¾“å‡ºç»“æœï¼šYour request url is /, and request method is GET</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="res-å“åº”å¯¹è±¡"><a href="#res-å“åº”å¯¹è±¡" class="headerlink" title="res å“åº”å¯¹è±¡"></a>res å“åº”å¯¹è±¡</h3><p>å¦‚æœæƒ³è®¿é—®ä¸==æœåŠ¡å™¨==ç›¸å…³çš„æ•°æ®æˆ–å±æ€§ï¼šres.end()</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> str = <span class="string">`Your request url is <span class="subst">$&#123;req.url&#125;</span>, and request method is <span class="subst">$&#123;req.method&#125;</span>`</span></span><br><span class="line">  <span class="comment">// è°ƒç”¨ res.end() æ–¹æ³•ï¼Œå‘å®¢æˆ·ç«¯å“åº”strã€‚å¹¶ç»“æŸè¿™æ¬¡è¯·æ±‚çš„å¤„ç†è¿‡ç¨‹</span></span><br><span class="line">  res.<span class="title function_">end</span>(str)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>==æ³¨æ„==ï¼šå½“è°ƒç”¨ res.end() æ–¹æ³•ï¼Œå‘å®¢æˆ·ç«¯å‘é€ä¸­æ–‡å†…å®¹çš„æ—¶å€™ï¼Œä¼šå‡ºç°ä¹±ç é—®é¢˜ï¼Œæ­¤æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨è®¾ç½®å†…å®¹çš„ç¼–ç æ ¼å¼ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> str = <span class="string">`æ‚¨è¯·æ±‚çš„ URL åœ°å€æ˜¯ <span class="subst">$&#123;req.url&#125;</span>ï¼Œè¯·æ±‚çš„ method ç±»å‹ä¸º <span class="subst">$&#123;req.method&#125;</span>`</span></span><br><span class="line">  <span class="comment">// è°ƒç”¨ res.setHeader() æ–¹æ³•ï¼Œè®¾ç½® Content-Type å“åº”å¤´ï¼Œè§£å†³ä¸­æ–‡ä¹±ç çš„é—®é¢˜</span></span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html; charset=utf-8&#x27;</span>)</span><br><span class="line">  res.<span class="title function_">end</span>(str)<span class="comment">// æ¨¡å—åŒ–ä¹‹å end() å…¨éƒ¨å˜ send()</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="æ¨¡å—åŒ–"><a href="#æ¨¡å—åŒ–" class="headerlink" title="æ¨¡å—åŒ–"></a>æ¨¡å—åŒ–</h1><h2 id="1-æ¨¡å—åŒ–çš„åŸºæœ¬æ¦‚å¿µ"><a href="#1-æ¨¡å—åŒ–çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1. æ¨¡å—åŒ–çš„åŸºæœ¬æ¦‚å¿µ"></a>1. æ¨¡å—åŒ–çš„åŸºæœ¬æ¦‚å¿µ</h2><p>ç±»ä¼¼äºç”µè„‘ä¸»æœºï¼Œä½ æ‡‚æˆ‘æ„æ€å§ã€‚</p>
<p>Node.js ä¸­æ ¹æ®æ¨¡å—æ¥æºçš„ä¸åŒï¼Œå°†æ¨¡å—åˆ†ä¸ºäº† 3 å¤§ç±»ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li><strong>å†…ç½®æ¨¡å—</strong>ï¼ˆå†…ç½®æ¨¡å—æ˜¯ç”± Node.js å®˜æ–¹æä¾›çš„ï¼Œä¾‹å¦‚ fsã€pathã€http ç­‰ï¼‰</li>
<li><strong>è‡ªå®šä¹‰æ¨¡å—</strong>ï¼ˆç”¨æˆ·åˆ›å»ºçš„æ¯ä¸ª .js æ–‡ä»¶ï¼Œéƒ½æ˜¯è‡ªå®šä¹‰æ¨¡å—ï¼‰</li>
<li><strong>ç¬¬ä¸‰æ–¹æ¨¡å—</strong>ï¼ˆç”±ç¬¬ä¸‰æ–¹å¼€å‘å‡ºæ¥çš„æ¨¡å—ï¼Œå¹¶éå®˜æ–¹æä¾›çš„å†…ç½®æ¨¡å—ï¼Œä¹Ÿä¸æ˜¯ç”¨æˆ·åˆ›å»ºçš„è‡ªå®šä¹‰æ¨¡å—ï¼Œä½¿ç”¨å‰éœ€è¦å…ˆä¸‹è½½ï¼‰</li>
</ul>
<p><code>require()</code>æ–¹æ³•ï¼Œå¯ä»¥åŠ è½½éœ€è¦çš„å†…ç½®æ¨¡å—ã€ç”¨æˆ·è‡ªå®šä¹‰æ¨¡å—ã€ç¬¬ä¸‰æ–¹æ¨¡å—è¿›è¡Œä½¿ç”¨ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>æ¨¡å—ä½œç”¨åŸŸ:</p>
<p>å’Œå‡½æ•°ä½œç”¨åŸŸç±»ä¼¼ï¼Œåœ¨è‡ªå®šä¹‰æ¨¡å—ä¸­å®šä¹‰çš„å˜é‡ã€æ–¹æ³•ç­‰æˆå‘˜ï¼Œåªèƒ½åœ¨å½“å‰æ¨¡å—å†…è¢«è®¿é—®ï¼Œè¿™ç§æ¨¡å—çº§åˆ«çš„è®¿é—®é™åˆ¶ï¼Œå«åšæ¨¡å—<br>ä½œç”¨åŸŸã€‚å¯ä»¥æœ‰æ•ˆé˜²æ­¢å˜é‡æ±¡æŸ“ã€‚</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img1.imgtp.com/2022/08/30/q7IgY6zn.png" alt="image-20220829203007219"></p>
<p>å‘å¤–å…±äº«æ¨¡å—ä½œç”¨åŸŸä¸­çš„æˆå‘˜ï¼š</p>
<ol>
<li>==module å¯¹è±¡==</li>
</ol>
<p>åœ¨æ¯ä¸ª .js è‡ªå®šä¹‰æ¨¡å—ä¸­éƒ½æœ‰ä¸€ä¸ª module å¯¹è±¡ï¼Œå®ƒé‡Œé¢å­˜å‚¨äº†å’Œå½“å‰æ¨¡å—æœ‰å…³çš„ä¿¡æ¯ï¼Œæ‰“å°å¦‚ä¸‹ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img1.imgtp.com/2022/08/30/SOQpq6Xx.png" alt="image-20220829203223692"></p>
<ol>
<li>==module.exports å¯¹è±¡==</li>
</ol>
<p>åœ¨è‡ªå®šä¹‰æ¨¡å—ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ module.exports å¯¹è±¡ï¼Œå°†æ¨¡å—å†…çš„æˆå‘˜å…±äº«å‡ºå»ï¼Œä¾›å¤–ç•Œä½¿ç”¨ã€‚å¤–ç•Œç”¨ require() æ–¹æ³•å¯¼å…¥è‡ªå®šä¹‰æ¨¡å—æ—¶ï¼Œå¾—åˆ°çš„å°±æ˜¯ module.exports æ‰€æŒ‡å‘çš„å¯¹è±¡ã€‚</p>
<p>ä½¿ç”¨ require() æ–¹æ³•å¯¼å…¥æ¨¡å—æ—¶ï¼Œå¯¼å…¥çš„ç»“æœï¼Œæ°¸è¿œä»¥ module.exports æŒ‡å‘çš„å¯¹è±¡ä¸ºå‡†ã€‚</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img1.imgtp.com/2022/08/30/yWPn0DiK.png" alt="image-20220829203405008"></p>
<ol>
<li>==exports å¯¹è±¡==</li>
</ol>
<p>ç”±äº module.exports å•è¯å†™èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œä¸ºäº†ç®€åŒ–å‘å¤–å…±äº«æˆå‘˜çš„ä»£ç ï¼ŒNode æä¾›äº† exports å¯¹è±¡ã€‚é»˜è®¤æƒ…å†µ<br>ä¸‹ï¼Œexports å’Œ module.exports æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚æœ€ç»ˆå…±äº«çš„ç»“æœï¼Œè¿˜æ˜¯ä»¥ module.exports æŒ‡å‘çš„å¯¹è±¡ä¸ºå‡†ã€‚</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img1.imgtp.com/2022/08/30/AQzPMWgu.png" alt="image-20220829203530932"></p>
<p>==æ³¨æ„==ï¼š</p>
<p>æ—¶åˆ»è°¨è®°ï¼Œrequire() æ¨¡å—æ—¶ï¼Œå¾—åˆ°çš„æ°¸è¿œæ˜¯ <strong>module.exports</strong> æŒ‡å‘çš„å¯¹è±¡ï¼š</p>
<p>ä¸å»ºè®®åŒä¸€ä¸ªæ¨¡å—ä¸­åŒæ—¶ä½¿ç”¨ exports å’Œ module.exports</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img1.imgtp.com/2022/08/30/GmXSmpfB.png" alt="image-20220829203802578"></p>
<h2 id="2-npmä¸åŒ…"><a href="#2-npmä¸åŒ…" class="headerlink" title="2. npmä¸åŒ…"></a>2. npmä¸åŒ…</h2><p>Node.js ä¸­çš„ç¬¬ä¸‰æ–¹æ¨¡å—åˆå«åšåŒ…ã€‚<br>å°±åƒç”µè„‘å’Œè®¡ç®—æœºæŒ‡çš„æ˜¯ç›¸åŒçš„ä¸œè¥¿ï¼Œç¬¬ä¸‰æ–¹æ¨¡å—å’ŒåŒ…æŒ‡çš„æ˜¯åŒä¸€ä¸ªæ¦‚å¿µï¼Œåªä¸è¿‡å«æ³•ä¸åŒã€‚</p>
<p>å›½å¤–æœ‰ä¸€å®¶ IT å…¬å¸ï¼Œå«åš npm, Inc. è¿™å®¶å…¬å¸æ——ä¸‹æœ‰ä¸€ä¸ªéå¸¸è‘—åçš„ç½‘ç«™ï¼š <a target="_blank" rel="noopener" href="https://www.npmjs.com/">https://www.npmjs.com/</a> ï¼Œå®ƒæ˜¯å…¨çƒæœ€<br>å¤§çš„åŒ…å…±äº«å¹³å°ï¼Œä½ å¯ä»¥ä»è¿™ä¸ªç½‘ç«™ä¸Šæœç´¢åˆ°ä»»ä½•ä½ éœ€è¦çš„åŒ…ï¼Œåªè¦ä½ æœ‰è¶³å¤Ÿçš„è€å¿ƒï¼<br>åˆ°ç›®å‰ä½ç½®ï¼Œå…¨çƒçº¦ 1100 å¤šä¸‡çš„å¼€å‘äººå‘˜ï¼Œé€šè¿‡è¿™ä¸ªåŒ…å…±äº«å¹³å°ï¼Œå¼€å‘å¹¶å…±äº«äº†è¶…è¿‡ 120 å¤šä¸‡ä¸ªåŒ… ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚<br>npm, Inc. å…¬å¸æä¾›äº†ä¸€ä¸ªåœ°å€ä¸º <a target="_blank" rel="noopener" href="https://registry.npmjs.org/">https://registry.npmjs.org/</a> çš„æœåŠ¡å™¨ï¼Œæ¥å¯¹å¤–å…±äº«æ‰€æœ‰çš„åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥ä»è¿™ä¸ªæœåŠ¡<br>å™¨ä¸Šä¸‹è½½è‡ªå·±æ‰€éœ€è¦çš„åŒ…ã€‚<br>æ³¨æ„ï¼š<br>âš« ä» <a target="_blank" rel="noopener" href="https://www.npmjs.com/">https://www.npmjs.com/</a> ç½‘ç«™ä¸Šæœç´¢è‡ªå·±æ‰€éœ€è¦çš„åŒ…<br>âš« ä» <a target="_blank" rel="noopener" href="https://registry.npmjs.org/">https://registry.npmjs.org/</a> æœåŠ¡å™¨ä¸Šä¸‹è½½è‡ªå·±éœ€è¦çš„åŒ…</p>
<p>åŒ…ç®¡ç†å·¥å…·çš„åå­—å«åš Node Package Managerï¼ˆç®€ç§° npm åŒ…ç®¡ç†å·¥å…·ï¼‰ï¼Œè¿™ä¸ªåŒ…ç®¡ç†å·¥å…·éšç€ Node.js çš„å®‰<br>è£…åŒ…ä¸€èµ·è¢«å®‰è£…åˆ°äº†ç”¨æˆ·çš„ç”µè„‘ä¸Šã€‚</p>
<p> npm -v å‘½ä»¤ï¼Œæ¥æŸ¥çœ‹è‡ªå·±ç”µè„‘ä¸Šæ‰€å®‰è£…çš„ npm åŒ…ç®¡ç†å·¥å…·çš„ç‰ˆæœ¬å·</p>
<p>å®‰è£…ç¬¬ä¸‰æ–¹åŒ…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i åŒ…å</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°å‘½ä»¤é»˜è®¤å®‰è£…æœ€æ–°ç‰ˆæœ¬åŒ…</p>
<p>å¦‚æœéœ€è¦å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„åŒ…ï¼Œå¯ä»¥åœ¨åŒ…åä¹‹åé€šè¿‡ <code>@ ç¬¦å·</code>æŒ‡å®šå…·ä½“çš„ç‰ˆæœ¬ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i moment@2.22.2</span><br></pre></td></tr></table></figure>
<p>åˆæ¬¡è£…åŒ…å®Œæˆåï¼Œåœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹å¤šä¸€ä¸ªå«åš ==node_modules== çš„æ–‡ä»¶å¤¹å’Œ ==package-lock.json== çš„é…ç½®æ–‡ä»¶ã€‚</p>
<ul>
<li>node_modules æ–‡ä»¶å¤¹ç”¨æ¥å­˜æ”¾æ‰€æœ‰å·²å®‰è£…åˆ°é¡¹ç›®ä¸­çš„åŒ…ã€‚require() å¯¼å…¥ç¬¬ä¸‰æ–¹åŒ…æ—¶ï¼Œå°±æ˜¯ä»è¿™ä¸ªç›®å½•ä¸­æŸ¥æ‰¾å¹¶åŠ è½½åŒ…ã€‚</li>
<li>package-lock.json é…ç½®æ–‡ä»¶ç”¨æ¥è®°å½• node_modules ç›®å½•ä¸‹çš„æ¯ä¸€ä¸ªåŒ…çš„ä¸‹è½½ä¿¡æ¯ï¼Œä¾‹å¦‚åŒ…çš„åå­—ã€ç‰ˆæœ¬å·ã€ä¸‹è½½åœ°å€ç­‰ã€‚</li>
</ul>
<p>åŒ…ç®¡ç†é…ç½®æ–‡ä»¶:</p>
<p>npm è§„å®šï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­ï¼Œå¿…é¡»æä¾›ä¸€ä¸ªå«åš ==package.json== çš„åŒ…ç®¡ç†é…ç½®æ–‡ä»¶ã€‚ç”¨æ¥è®°å½•ä¸é¡¹ç›®æœ‰å…³çš„ä¸€äº›é…ç½®<br>ä¿¡æ¯ã€‚ä¿¡æ¯å­˜æ”¾åœ¨ dependencies  èŠ‚ç‚¹ä¸­ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>é¡¹ç›®çš„åç§°ã€ç‰ˆæœ¬å·ã€æè¿°ç­‰</li>
<li>é¡¹ç›®ä¸­éƒ½ç”¨åˆ°äº†å“ªäº›åŒ…</li>
<li>å“ªäº›åŒ…åªåœ¨å¼€å‘æœŸé—´ä¼šç”¨åˆ°</li>
<li>é‚£äº›åŒ…åœ¨å¼€å‘å’Œéƒ¨ç½²æ—¶éƒ½éœ€è¦ç”¨åˆ°</li>
</ul>
<p>æ–°å»ºé¡¹ç›®æ—¶è¿›å…¥æ–‡ä»¶å¤¹ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å³å¯è‡ªåŠ¨ç”Ÿæˆ package.json åŒ…ç®¡ç†é…ç½®æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br></pre></td></tr></table></figure>
<p>npm åŒ…ç®¡ç†å·¥å…·ä¼šè‡ªåŠ¨æŠŠåŒ…çš„åç§°å’Œç‰ˆæœ¬å·ï¼Œè®°å½•åˆ° package.json ä¸­ã€‚</p>
<p>å½“æˆ‘ä»¬æ‹¿åˆ°ä¸€ä¸ªå‰”é™¤äº† node_modules çš„é¡¹ç›®ä¹‹åï¼Œéœ€è¦å…ˆæŠŠæ‰€æœ‰çš„åŒ…ä¸‹è½½åˆ°é¡¹ç›®ä¸­ï¼Œæ‰èƒ½å°†é¡¹ç›®è¿è¡Œèµ·æ¥ã€‚<br>æ‰§è¡Œä¸‹é¢å‘½ä»¤å®‰è£…æ‰€æœ‰åŒ…ã€‚ä» package.json ä¸­è¯»å–æŒ‰è¿‡çš„åŒ…</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i</span><br></pre></td></tr></table></figure>
<p>å¸è½½åŒ…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall åŒ…å</span><br></pre></td></tr></table></figure>
<p>npm uninstall å‘½ä»¤æ‰§è¡ŒæˆåŠŸåï¼Œä¼šæŠŠå¸è½½çš„åŒ…ï¼Œè‡ªåŠ¨ä» package.json çš„ dependencies ä¸­ç§»é™¤æ‰ã€‚</p>
<p>åªåœ¨é¡¹ç›®å¼€å‘é˜¶æ®µä¼šç”¨åˆ°ï¼Œåœ¨é¡¹ç›®ä¸Šçº¿ä¹‹åä¸ä¼šç”¨åˆ°çš„åŒ…å®‰è£…å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i åŒ…å -D</span><br></pre></td></tr></table></figure>
<p>å‘½ä»¤ç­‰ä»·äº===npm i åŒ…å â€”save-dev</p>
<p>è¿™äº›åŒ…å°†è¢«è®°å½•åˆ° devDependencies èŠ‚ç‚¹ä¸­ã€‚ä¸ä¹‹å¯¹åº”çš„ï¼Œå¦‚æœæŸäº›åŒ…åœ¨å¼€å‘å’Œé¡¹ç›®ä¸Šçº¿ä¹‹åéƒ½éœ€è¦ç”¨åˆ°ï¼Œåˆ™å»ºè®®æŠŠè¿™äº›åŒ…è®°å½•åˆ° dependencies èŠ‚ç‚¹ä¸­ã€‚</p>
<p>å›½å¤–æœåŠ¡å™¨ï¼Œä¸‹åŒ…æ…¢ï¼Œåˆ‡æ¢é•œåƒæºåˆ°æ·˜å®</p>
<ul>
<li>æŸ¥çœ‹å½“å‰é•œåƒæº</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config get registry</span><br></pre></td></tr></table></figure>
<ul>
<li>åˆ‡æ¢ä¸ºæ·˜å®é•œåƒæº</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config <span class="built_in">set</span> registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>
<ul>
<li>æ£€æµ‹é•œåƒæºæ˜¯å¦ä¸‹è½½æˆåŠŸ</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config get registry</span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†æ›´æ–¹ä¾¿çš„åˆ‡æ¢ä¸‹åŒ…çš„é•œåƒæºï¼Œæˆ‘ä»¬å¯ä»¥å®‰è£… nrm è¿™ä¸ªå°å·¥å…·ï¼Œåˆ©ç”¨ nrm æä¾›çš„ç»ˆç«¯å‘½ä»¤ï¼Œå¯ä»¥å¿«é€ŸæŸ¥çœ‹å’Œåˆ‡æ¢ä¸‹<br>åŒ…çš„é•œåƒæºã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm i nrm -g</span><br><span class="line">nrm <span class="built_in">ls</span></span><br><span class="line">nrm use taobao</span><br></pre></td></tr></table></figure>
<hr>
<p>åŒ…çš„åˆ†ç±»ï¼š</p>
<ul>
<li>é¡¹ç›®åŒ…</li>
</ul>
<p>è¢«å®‰è£…åˆ°é¡¹ç›®çš„ node_modules ç›®å½•ä¸­çš„åŒ…ï¼Œéƒ½æ˜¯é¡¹ç›®åŒ…</p>
<p>é¡¹ç›®åŒ…åˆåˆ†ä¸ºä¸¤ç±»ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i åŒ…å -D  <span class="comment">#å¼€å‘ä¾èµ–åŒ…ï¼ˆè¢«è®°å½•åˆ° devDependencies èŠ‚ç‚¹ä¸­çš„åŒ…ï¼Œåªåœ¨å¼€å‘æœŸé—´ä¼šç”¨åˆ°ï¼‰</span></span><br><span class="line">npm i åŒ…å     <span class="comment">#æ ¸å¿ƒä¾èµ–åŒ…ï¼ˆè¢«è®°å½•åˆ° dependencies èŠ‚ç‚¹ä¸­çš„åŒ…ï¼Œåœ¨å¼€å‘æœŸé—´å’Œé¡¹ç›®ä¸Šçº¿ä¹‹åéƒ½ä¼šç”¨åˆ°ï¼‰</span></span><br></pre></td></tr></table></figure>
<ul>
<li>å…¨å±€åŒ…</li>
</ul>
<p>å…¨å±€åŒ…ä¼šè¢«å®‰è£…åˆ° C:\Users\ç”¨æˆ·ç›®å½•\AppData\Roaming\npm\node_modules ç›®å½•ä¸‹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i åŒ…å -g 		<span class="comment">#å…¨å±€å®‰è£…åŒ…</span></span><br><span class="line">npm uninstall åŒ…å    <span class="comment">#å¸è½½å…¨å±€å®‰è£…åŒ…</span></span><br></pre></td></tr></table></figure>
<p>æ³¨ï¼šåªæœ‰å·¥å…·æ€§è´¨çš„åŒ…ï¼Œæ‰æœ‰å…¨å±€å®‰è£…çš„å¿…è¦æ€§ã€‚å› ä¸ºå®ƒä»¬æä¾›äº†å¥½ç”¨çš„ç»ˆç«¯å‘½ä»¤ã€‚</p>
<hr>
<h1 id="Express"><a href="#Express" class="headerlink" title="Express"></a>Express</h1><p>Express æ˜¯åŸºäº Node.js å¹³å°ï¼ŒåŸºäºhttpæ¨¡å—ï¼Œå¿«é€Ÿã€å¼€æ”¾ã€æç®€çš„ Web å¼€å‘æ¡†æ¶ã€‚<br>é€šä¿—çš„ç†è§£ï¼šExpress çš„ä½œç”¨å’Œ Node.js å†…ç½®çš„ http æ¨¡å—ç±»ä¼¼ï¼Œæ˜¯ä¸“é—¨ç”¨æ¥åˆ›å»º Web æœåŠ¡å™¨çš„ã€‚<br>Express çš„æœ¬è´¨ï¼šå°±æ˜¯ä¸€ä¸ª npm ä¸Šçš„ç¬¬ä¸‰æ–¹åŒ…ï¼Œæä¾›äº†å¿«é€Ÿåˆ›å»º Web æœåŠ¡å™¨çš„ä¾¿æ·æ–¹æ³•ã€‚<br>Express çš„ä¸­æ–‡å®˜ç½‘ï¼š <a target="_blank" rel="noopener" href="http://www.expressjs.com.cn/">http://www.expressjs.com.cn/</a></p>
<p>å®‰è£…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i express@4.17.1</span><br></pre></td></tr></table></figure>
<h2 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. å¯¼å…¥ express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 2. åˆ›å»º web æœåŠ¡å™¨</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"><span class="comment">// --------------------</span></span><br><span class="line"><span class="comment">// 4. ç›‘å¬å®¢æˆ·ç«¯çš„ GET å’Œ POST è¯·æ±‚ï¼Œå¹¶å‘å®¢æˆ·ç«¯å“åº”å…·ä½“çš„å†…å®¹</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/user&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// è°ƒç”¨ express æä¾›çš„ res.send() æ–¹æ³•ï¼Œå‘å®¢æˆ·ç«¯å“åº”ä¸€ä¸ª JSON å¯¹è±¡</span></span><br><span class="line">  res.<span class="title function_">send</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>, <span class="attr">age</span>: <span class="number">20</span>, <span class="attr">gender</span>: <span class="string">&#x27;ç”·&#x27;</span> &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/user&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// è°ƒç”¨ express æä¾›çš„ res.send() æ–¹æ³•ï¼Œå‘å®¢æˆ·ç«¯å“åº”ä¸€ä¸ª æ–‡æœ¬å­—ç¬¦ä¸²</span></span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;è¯·æ±‚æˆåŠŸ&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// é€šè¿‡ req.query å¯ä»¥è·å–åˆ°å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„ æŸ¥è¯¢å‚æ•°</span></span><br><span class="line">  <span class="comment">// æ³¨æ„ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œreq.query æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">query</span>)</span><br><span class="line">  res.<span class="title function_">send</span>(req.<span class="property">query</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// æ³¨æ„ï¼šè¿™é‡Œçš„ :id æ˜¯ä¸€ä¸ªåŠ¨æ€çš„å‚æ•°</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/user/:ids/:username&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// req.params æ˜¯åŠ¨æ€åŒ¹é…åˆ°çš„ URL å‚æ•°ï¼Œé»˜è®¤ä¹Ÿæ˜¯ä¸€ä¸ªç©ºå¯¹è±¡</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">params</span>)</span><br><span class="line">  res.<span class="title function_">send</span>(req.<span class="property">params</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// --------------------</span></span><br><span class="line"><span class="comment">// 3. å¯åŠ¨ web æœåŠ¡å™¨</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;express server running at http://127.0.0.1&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p> æ‰˜ç®¡é™æ€èµ„æºï¼š</p>
<p><code>express.static()</code></p>
<p>express æä¾›äº†ä¸€ä¸ªéå¸¸å¥½ç”¨çš„å‡½æ•°ï¼Œå«åš express.static()ï¼Œé€šè¿‡å®ƒï¼Œæˆ‘ä»¬å¯ä»¥éå¸¸æ–¹ä¾¿åœ°åˆ›å»ºä¸€ä¸ªé™æ€èµ„æºæœåŠ¡å™¨ï¼Œ<br>ä¾‹å¦‚ï¼Œé€šè¿‡å¦‚ä¸‹ä»£ç å°±å¯ä»¥å°† public ç›®å½•ä¸‹çš„å›¾ç‰‡ã€CSS æ–‡ä»¶ã€JavaScript æ–‡ä»¶å¯¹å¤–å¼€æ”¾è®¿é—®äº†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨è¿™é‡Œï¼Œè°ƒç”¨ express.static() æ–¹æ³•ï¼Œå¿«é€Ÿçš„å¯¹å¤–æä¾›é™æ€èµ„æº</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/public&#x27;</span>, express.<span class="title function_">static</span>(<span class="string">&#x27;public&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ï¼Œä½ å°±å¯ä»¥é€šè¿‡å¸¦æœ‰ /public å‰ç¼€åœ°å€æ¥è®¿é—® public ç›®å½•ä¸­çš„æ–‡ä»¶äº†ï¼š</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost/public/images/kitten.jpg">http://localhost/public/images/kitten.jpg</a><br><a target="_blank" rel="noopener" href="http://localhost/public/css/style.css">http://localhost/public/css/style.css</a><br><a target="_blank" rel="noopener" href="http://localhost/public/js/app.js">http://localhost/public/js/app.js</a></p>
</blockquote>
<hr>
<blockquote>
<p>åœ¨ç¼–å†™è°ƒè¯• Node.js é¡¹ç›®çš„æ—¶å€™ï¼Œå¦‚æœä¿®æ”¹äº†é¡¹ç›®çš„ä»£ç ï¼Œåˆ™éœ€è¦é¢‘ç¹çš„æ‰‹åŠ¨ close æ‰ï¼Œç„¶åå†é‡æ–°å¯åŠ¨ï¼Œéå¸¸ç¹çã€‚<br>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ nodemonï¼ˆ<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/nodemonï¼‰">https://www.npmjs.com/package/nodemonï¼‰</a> è¿™ä¸ªå·¥å…·ï¼Œå®ƒèƒ½å¤Ÿç›‘å¬é¡¹ç›®æ–‡ä»¶<br>çš„å˜åŠ¨ï¼Œå½“ä»£ç è¢«ä¿®æ”¹åï¼Œnodemon ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬é‡å¯é¡¹ç›®ï¼Œæå¤§æ–¹ä¾¿äº†å¼€å‘å’Œè°ƒè¯•ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -g nodemon</span><br></pre></td></tr></table></figure>
<p>node app.js æ›¿æ¢ä¸º nodemon app.js</p>
</blockquote>
<hr>
<h2 id="Express-è·¯ç”±"><a href="#Express-è·¯ç”±" class="headerlink" title="Express è·¯ç”±"></a>Express è·¯ç”±</h2><p>å¹¿ä¹‰ä¸Šæ¥è®²ï¼Œè·¯ç”±å°±æ˜¯æ˜ å°„å…³ç³»ã€‚</p>
<p>åœ¨ Express ä¸­ï¼Œè·¯ç”±æŒ‡çš„æ˜¯å®¢æˆ·ç«¯çš„è¯·æ±‚ä¸æœåŠ¡å™¨å¤„ç†å‡½æ•°ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚<br>Express ä¸­çš„è·¯ç”±åˆ† 3 éƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯è¯·æ±‚çš„ç±»å‹ã€è¯·æ±‚çš„ URL åœ°å€ã€å¤„ç†å‡½æ•°</p>
<p>Express ä¸­çš„è·¯ç”±çš„ä¾‹å­ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"><span class="comment">// æŒ‚è½½è·¯ç”±</span></span><br><span class="line"><span class="comment">// åŒ¹é… GET è¯·æ±‚ï¼Œè¯·æ±‚ URL ä¸º /</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;hello world.&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// åŒ¹é… POST è¯·æ±‚ï¼Œè¯·æ±‚ URL ä¸º /</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;Post Request.&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// è¯·æ±‚ç±»å‹å’Œè¯·æ±‚çš„URLåŒæ—¶åŒ¹é…æˆåŠŸï¼Œæ‰ä¼šè°ƒç”¨å¯¹åº”çš„å¤„ç†å‡½æ•°</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;http://127.0.0.1&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ï¼š</p>
<p>ä¸ºäº†æ–¹ä¾¿å¯¹è·¯ç”±è¿›è¡Œæ¨¡å—åŒ–çš„ç®¡ç†ï¼ŒExpress ä¸å»ºè®®å°†è·¯ç”±ç›´æ¥æŒ‚è½½åˆ° app ä¸Šï¼Œè€Œæ˜¯æ¨èå°†è·¯ç”±æŠ½ç¦»ä¸ºå•ç‹¬çš„æ¨¡å—ã€‚<br>å°†è·¯ç”±æŠ½ç¦»ä¸ºå•ç‹¬æ¨¡å—çš„æ­¥éª¤å¦‚ä¸‹ï¼š<br>â‘  åˆ›å»ºè·¯ç”±æ¨¡å—å¯¹åº”çš„ .js æ–‡ä»¶<br>â‘¡ è°ƒç”¨ express.Router() å‡½æ•°åˆ›å»ºè·¯ç”±å¯¹è±¡<br>â‘¢ å‘è·¯ç”±å¯¹è±¡ä¸ŠæŒ‚è½½å…·ä½“çš„è·¯ç”±<br>â‘£ ä½¿ç”¨ module.exports å‘å¤–å…±äº«è·¯ç”±å¯¹è±¡<br>â‘¤ ä½¿ç”¨ app.use() å‡½æ•°æ³¨å†Œè·¯ç”±æ¨¡å—</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"><span class="comment">// å¯¼å…¥è·¯ç”±æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">&#x27;./user_router&#x27;</span>)</span><br><span class="line"><span class="comment">// 5. æ³¨å†Œè·¯ç”±æ¨¡å—ï¼Œå¹¶ä¸ºè·¯ç”±æ¨¡å—æ·»åŠ å‰ç¼€ /api</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/api&#x27;</span>, router)</span><br><span class="line"><span class="comment">// æ³¨æ„ï¼š app.use() å‡½æ•°çš„ä½œç”¨ï¼Œå°±æ˜¯æ¥æ³¨å†Œå…¨å±€ä¸­é—´ä»¶</span></span><br><span class="line"><span class="comment">// è¯·æ±‚åœ°å€å˜ä¸ºäº† http://127.0.0.1/api/......</span></span><br><span class="line"><span class="comment">// app.use(&#x27;/files&#x27;, express.static(&#x27;./files&#x27;))</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;http://127.0.0.1&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºçš„è·¯ç”±æ¨¡å—jsæ–‡ä»¶ï¼ˆuser_router.jsï¼‰</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. åˆ›å»º user_router.jsï¼Œå¯¼å…¥ express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 2. åˆ›å»ºè·¯ç”±å¯¹è±¡</span></span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>()</span><br><span class="line"><span class="comment">// 3. æŒ‚è½½å…·ä½“çš„è·¯ç”±</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/user/list&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;Get user list.by URL http://127.0.0.1/api/user/list&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/user/add&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;Add new user.&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 4. å‘å¤–å¯¼å‡ºè·¯ç”±å¯¹è±¡</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Express-ä¸­é—´ä»¶"><a href="#Express-ä¸­é—´ä»¶" class="headerlink" title="Express ä¸­é—´ä»¶"></a>Express ä¸­é—´ä»¶</h2><p>ä¸­é—´ä»¶ï¼ˆMiddleware ï¼‰ï¼Œç‰¹æŒ‡ä¸šåŠ¡æµç¨‹çš„ä¸­é—´å¤„ç†ç¯èŠ‚ã€‚</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img1.imgtp.com/2022/08/30/6qCivFo6.png" alt="image-20220829214331133"></p>
<p>å½“ä¸€ä¸ªè¯·æ±‚åˆ°è¾¾ Express çš„æœåŠ¡å™¨ä¹‹åï¼Œå¯ä»¥è¿ç»­è°ƒç”¨å¤šä¸ªä¸­é—´ä»¶ï¼Œä»è€Œå¯¹è¿™æ¬¡è¯·æ±‚è¿›è¡Œé¢„å¤„ç†ã€‚</p>
<p>Express çš„ä¸­é—´ä»¶ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ª function å¤„ç†å‡½æ•°ï¼ŒExpress ä¸­é—´ä»¶çš„æ ¼å¼å¦‚ä¸‹ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img1.imgtp.com/2022/08/30/kotwSQ0M.png" alt="image-20220829214506369"></p>
<p>ä¸­é—´ä»¶å‡½æ•°çš„å½¢å‚åˆ—è¡¨ä¸­ï¼Œå¿…é¡»åŒ…å« next å‚æ•°ã€‚è€Œè·¯ç”±å¤„ç†å‡½æ•°ä¸­åªåŒ…å« req å’Œ resã€‚</p>
<p>next å‡½æ•°æ˜¯å®ç°å¤šä¸ªä¸­é—´ä»¶è¿ç»­è°ƒç”¨çš„å…³é”®ï¼Œå®ƒè¡¨ç¤ºæŠŠæµè½¬å…³ç³»è½¬äº¤ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶æˆ–è·¯ç”±</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img1.imgtp.com/2022/08/30/JIacgRGt.png" alt="image-20220829214642281"></p>
<p>å®šä¹‰ä¸­é—´ä»¶å‡½æ•°ï¼š</p>
<p>ä¸­é—´ä»¶éœ€è¦åœ¨è·¯ç”±ä¹‹å‰å®šä¹‰ï¼Œå› ä¸ºjsä»ä¸Šåˆ°ä¸‹è¯»</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªæœ€ç®€å•çš„ä¸­é—´ä»¶å‡½æ•°</span></span><br><span class="line"><span class="comment">// const mw = function (req, res, next) &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;è¿™æ˜¯æœ€ç®€å•çš„ä¸­é—´ä»¶å‡½æ•°&#x27;)</span></span><br><span class="line"><span class="comment">//   // æŠŠæµè½¬å…³ç³»ï¼Œè½¬äº¤ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶æˆ–è·¯ç”±</span></span><br><span class="line"><span class="comment">//   next()</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// å°† mw æ³¨å†Œä¸ºå…¨å±€ç”Ÿæ•ˆçš„ä¸­é—´ä»¶</span></span><br><span class="line"><span class="comment">// app.use(mw)</span></span><br><span class="line"><span class="comment">// *************************</span></span><br><span class="line"><span class="comment">// è¿™æ˜¯å®šä¹‰å…¨å±€ä¸­é—´ä»¶çš„ç®€åŒ–å½¢å¼</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¿™æ˜¯æœ€ç®€å•çš„ä¸­é—´ä»¶å‡½æ•°&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> time = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">  <span class="comment">// ä¸º req å¯¹è±¡ï¼ŒæŒ‚è½½è‡ªå®šä¹‰å±æ€§ï¼Œä»è€ŒæŠŠæ—¶é—´å…±äº«ç»™åé¢çš„æ‰€æœ‰è·¯ç”±ã€‚å¤šä¸ªä¸­é—´ä»¶ä¹‹é—´ï¼Œå…±äº« req å’Œ res å¯¹è±¡</span></span><br><span class="line">  req.<span class="property">startTime</span> = time</span><br><span class="line">  <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// *************************</span></span><br></pre></td></tr></table></figure>
<p>å®šä¹‰å±€éƒ¨ç”Ÿæ•ˆçš„ä¸­é—´ä»¶ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"><span class="comment">// 1. å®šä¹‰ä¸­é—´ä»¶å‡½æ•°</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">mw1</span> = (<span class="params">req, res, next</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è°ƒç”¨äº†å±€éƒ¨ç”Ÿæ•ˆçš„ä¸­é—´ä»¶&#x27;</span>)</span><br><span class="line">  <span class="title function_">next</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 2. åˆ›å»ºè·¯ç”±ï¼Œå¼•å…¥mw1ä¸­é—´ä»¶</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, mw1, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;Home page.&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// åŒæ—¶ä½¿ç”¨å¤šä¸ªå±€éƒ¨ä¸­é—´ä»¶</span></span><br><span class="line"><span class="comment">// app.get(&#x27;/&#x27;, [mw1, mw2], (req, res) =&gt; &#123;res.send(&#x27;Home page.&#x27;)&#125;)</span></span><br><span class="line"><span class="comment">// ç­‰ä»·äº app.get(&#x27;/&#x27;, mw1, mw2, (req, res) =&gt; &#123;res.send(&#x27;Home page.&#x27;)&#125;)</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/user&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;User page.&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Express server running at http://127.0.0.1&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†æ–¹ä¾¿å¤§å®¶ç†è§£å’Œè®°å¿†ä¸­é—´ä»¶çš„ä½¿ç”¨ï¼ŒExpress å®˜æ–¹æŠŠå¸¸è§çš„ä¸­é—´ä»¶ç”¨æ³•ï¼Œåˆ†æˆäº† 5 å¤§ç±»ï¼Œåˆ†åˆ«æ˜¯ï¼š<br>â‘  åº”ç”¨çº§åˆ«çš„ä¸­é—´ä»¶<br>â‘¡ è·¯ç”±çº§åˆ«çš„ä¸­é—´ä»¶<br>â‘¢ é”™è¯¯çº§åˆ«çš„ä¸­é—´ä»¶<br>â‘£ Express å†…ç½®çš„ä¸­é—´ä»¶<br>â‘¤ ç¬¬ä¸‰æ–¹çš„ä¸­é—´ä»¶</p>
<ol>
<li>åº”ç”¨çº§åˆ«çš„ä¸­é—´ä»¶</li>
</ol>
<p>é€šè¿‡ app.use() æˆ– app.get() æˆ– app.post() ï¼Œç»‘å®šåˆ° app å®ä¾‹ä¸Šçš„ä¸­é—´ä»¶ï¼Œå«åšåº”ç”¨çº§åˆ«çš„ä¸­é—´ä»¶ï¼Œä»£ç å·²ç»ç»™å‡ºï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…¨å±€</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// å±€éƒ¨</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, mw1, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;Home page.&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>è·¯ç”±çº§åˆ«çš„ä¸­é—´ä»¶</li>
</ol>
<p>ç»‘å®šåˆ° express.Router() å®ä¾‹ä¸Šçš„ä¸­é—´ä»¶ï¼Œå«åšè·¯ç”±çº§åˆ«çš„ä¸­é—´ä»¶ã€‚å®ƒçš„ç”¨æ³•å’Œåº”ç”¨çº§åˆ«ä¸­é—´ä»¶æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚åªä¸è¿‡ï¼Œ<strong>åº”ç”¨çº§åˆ«ä¸­é—´ä»¶æ˜¯ç»‘å®šåˆ° app å®ä¾‹ä¸Šï¼Œè·¯ç”±çº§åˆ«ä¸­é—´ä»¶ç»‘å®šåˆ° router å®ä¾‹ä¸Š</strong>ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">exoress</span>()</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>()</span><br><span class="line"><span class="comment">// è·¯ç”±çº§åˆ«ä¸­é—´ä»¶,æ­¤å¤„å…ˆä¸å¿…æ·±ç©¶</span></span><br><span class="line">router.<span class="title function_">use</span>(<span class="keyword">function</span>(<span class="params">req,res,next</span>)&#123;</span><br><span class="line">	<span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/&#x27;</span>,router)</span><br></pre></td></tr></table></figure>
<ol>
<li>é”™è¯¯çº§åˆ«çš„ä¸­é—´ä»¶</li>
</ol>
<p>é”™è¯¯çº§åˆ«ä¸­é—´ä»¶çš„ä½œç”¨ï¼šä¸“é—¨ç”¨æ¥æ•è·æ•´ä¸ªé¡¹ç›®ä¸­å‘ç”Ÿçš„å¼‚å¸¸é”™è¯¯ï¼Œä»è€Œé˜²æ­¢é¡¹ç›®å¼‚å¸¸å´©æºƒçš„é—®é¢˜ã€‚<br>æ ¼å¼ï¼šé”™è¯¯çº§åˆ«ä¸­é—´ä»¶çš„ function å¤„ç†å‡½æ•°ä¸­ï¼Œå¿…é¡»æœ‰ 4 ä¸ªå½¢å‚ï¼Œå½¢å‚é¡ºåºä»å‰åˆ°åï¼Œåˆ†åˆ«æ˜¯ (err, req, res, next)ã€‚</p>
<p>==æ³¨æ„==ï¼šé”™è¯¯çº§åˆ«çš„ä¸­é—´ä»¶ï¼Œå¿…é¡»æ³¨å†Œåœ¨æ‰€æœ‰è·¯ç”±ä¹‹åï¼</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"><span class="comment">// 1. å®šä¹‰è·¯ç”±</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 1.1 äººä¸ºçš„åˆ¶é€ é”™è¯¯</span></span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;æœåŠ¡å™¨å†…éƒ¨å‘ç”Ÿäº†é”™è¯¯ï¼&#x27;</span>)</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;Home page.&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. å®šä¹‰é”™è¯¯çº§åˆ«çš„ä¸­é—´ä»¶ï¼Œæ•è·æ•´ä¸ªé¡¹ç›®çš„å¼‚å¸¸é”™è¯¯ï¼Œä»è€Œé˜²æ­¢ç¨‹åºçš„å´©æºƒ</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123; <span class="comment">// å¿…é¡»å¸¦4ä¸ªå‚æ•°ï¼Œä»£ç å—ä¸­æ²¡æœ‰next()</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;å‘ç”Ÿäº†é”™è¯¯ï¼&#x27;</span> + err.<span class="property">message</span>)</span><br><span class="line">  <span class="comment">// å‘é€å¼‚å¸¸ç»™å®¢æˆ·ç«¯</span></span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;Errorï¼š&#x27;</span> + err.<span class="property">message</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Express server running at http://127.0.0.1&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>Expresså†…ç½®çš„ä¸­é—´ä»¶</li>
</ol>
<p>è‡ª Express 4.16.0 ç‰ˆæœ¬å¼€å§‹ï¼ŒExpress å†…ç½®äº† 3 ä¸ªå¸¸ç”¨çš„ä¸­é—´ä»¶ï¼Œæå¤§çš„æé«˜äº† Express é¡¹ç›®çš„å¼€å‘æ•ˆç‡å’Œä½“éªŒï¼š<br>â‘  express.static å¿«é€Ÿæ‰˜ç®¡é™æ€èµ„æºçš„å†…ç½®ä¸­é—´ä»¶ï¼Œä¾‹å¦‚ï¼š HTML æ–‡ä»¶ã€å›¾ç‰‡ã€CSS æ ·å¼ç­‰ï¼ˆæ— å…¼å®¹æ€§ï¼‰<br>â‘¡ express.json è§£æ JSON æ ¼å¼çš„è¯·æ±‚ä½“æ•°æ®ï¼ˆæœ‰å…¼å®¹æ€§ï¼Œä»…åœ¨ 4.16.0+ ç‰ˆæœ¬ä¸­å¯ç”¨ï¼‰<br>â‘¢ express.urlencoded è§£æ URL-encoded æ ¼å¼çš„è¯·æ±‚ä½“æ•°æ®ï¼ˆæœ‰å…¼å®¹æ€§ï¼Œä»…åœ¨ </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img1.imgtp.com/2022/08/30/jLQY3nCY.png" alt="image-20220829221153096"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³¨æ„ï¼šé™¤äº†é”™è¯¯çº§åˆ«çš„ä¸­é—´ä»¶ï¼Œå…¶ä»–çš„ä¸­é—´ä»¶ï¼Œå¿…é¡»åœ¨è·¯ç”±ä¹‹å‰è¿›è¡Œé…ç½®</span></span><br><span class="line"><span class="comment">// è§£æè¡¨å•ä¸­çš„ JSON æ ¼å¼çš„æ•°æ®</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>())</span><br><span class="line"><span class="comment">// è§£æè¡¨å•ä¸­çš„ url-encoded æ ¼å¼çš„æ•°æ®</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/user&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// åœ¨æœåŠ¡å™¨ç«¯ï¼Œå¯ä»¥é€šè¿‡ req,body æ¥è·å–æ¥æ¥æ”¶å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚ä½“æ•°æ®ï¼ŒåŒ…æ‹¬ JSON æ ¼å¼çš„è¡¨å•æ•°æ®å’Œ url-encoded æ ¼å¼çš„æ•°æ®</span></span><br><span class="line">  <span class="comment">// é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä¸é…ç½®è§£æè¡¨å•æ•°æ®çš„ä¸­é—´ä»¶ï¼Œåˆ™ req.body é»˜è®¤ç­‰äº undefined</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>)</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>ç¬¬ä¸‰æ–¹çš„ä¸­é—´ä»¶</li>
</ol>
<p>ã€‚ã€‚ã€‚æ¯”å¦‚ï¼Œè€ç‰ˆæœ¬çš„ body-parserã€‚åŠŸèƒ½åŒ express.urlencodedã€‚åè€…å°±æ˜¯åŸºäºå‰è€…å°è£…çš„ã€‚</p>
<ol>
<li>è‡ªå®šä¹‰ä¸­é—´ä»¶</li>
</ol>
<p>ä¾‹å¦‚ï¼šæ¨¡æ‹Ÿ express.urlencoded å¯¹è¯·æ±‚ä½“è¿›è¡Œè§£æã€‚å®ç°æ­¥éª¤ï¼š<br>â‘  å®šä¹‰ä¸­é—´ä»¶ app.use((req, res, next) =&gt; {â€¦})<br>â‘¡ ç›‘å¬ req çš„ data äº‹ä»¶<br>â‘¢ ç›‘å¬ req çš„ end äº‹ä»¶<br>â‘£ ä½¿ç”¨ querystring æ¨¡å—è§£æè¯·æ±‚ä½“æ•°æ®<br>â‘¤ å°†è§£æå‡ºæ¥çš„æ•°æ®å¯¹è±¡æŒ‚è½½ä¸º req.body<br>â‘¥ å°†è‡ªå®šä¹‰ä¸­é—´ä»¶å°è£…ä¸ºæ¨¡å—</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"><span class="comment">// å¯¼å…¥ Node.js å†…ç½®çš„ querystring æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> qs = <span class="built_in">require</span>(<span class="string">&#x27;querystring&#x27;</span>)</span><br><span class="line"><span class="comment">// 1. è§£æè¡¨å•æ•°æ®çš„ä¸­é—´ä»¶</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// str å­—ç¬¦ä¸²å­˜å‚¨è¯·æ±‚ä½“æ•°æ®</span></span><br><span class="line">  <span class="keyword">let</span> str = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="comment">// 2. ç›‘å¬ req çš„ data äº‹ä»¶</span></span><br><span class="line">  req.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">    str += chunk</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 3. ç›‘å¬ req çš„ end äº‹ä»¶</span></span><br><span class="line">  req.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 4. æŠŠå­—ç¬¦ä¸²æ ¼å¼çš„è¯·æ±‚ä½“æ•°æ®è§£ææˆå¯¹è±¡æ ¼å¼</span></span><br><span class="line">    <span class="keyword">const</span> body = qs.<span class="title function_">parse</span>(str)</span><br><span class="line">    <span class="comment">// 5. å¯¹è±¡æŒ‚è½½åˆ°è‡ªå®šä¹‰å±æ€§bodyä¸Š</span></span><br><span class="line">    req.<span class="property">body</span> = body</span><br><span class="line">    <span class="comment">// äº¤ç”±è·¯ç”±å¤„ç†</span></span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/user&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(req.<span class="property">body</span>)</span><br><span class="line">&#125;)</span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Express server running at http://127.0.0.1&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>==æ³¨==ï¼šå…³é”®å­— const å®šä¹‰å¸¸é‡ã€‚let å®šä¹‰å˜é‡ã€‚</p>
<p>â‘¥ å°†è‡ªå®šä¹‰ä¸­é—´ä»¶å°è£…ä¸ºæ¨¡å—</p>
<p>ç¬¬ä¸€æ­¥ï¼šæ–°å»ºjsæ–‡ä»¶ï¼Œå†…å®¹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¼å…¥ Node.js å†…ç½®çš„ querystring æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> qs = <span class="built_in">require</span>(<span class="string">&#x27;querystring&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">bodyParser</span> = (<span class="params">req, res, next</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> str = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  req.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;str += chunk&#125;)</span><br><span class="line">  req.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> body = qs.<span class="title function_">parse</span>(str)</span><br><span class="line">    req.<span class="property">body</span> = body</span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = bodyParser</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒæ­¥ï¼šä½¿ç”¨</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. å¯¼å…¥è‡ªå·±å°è£…çš„ä¸­é—´ä»¶æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> customBodyParser = <span class="built_in">require</span>(<span class="string">&#x27;./my-body-parser&#x27;</span>)</span><br><span class="line"><span class="comment">// 2. å°†è‡ªå®šä¹‰çš„ä¸­é—´ä»¶å‡½æ•°ï¼Œæ³¨å†Œä¸ºå…¨å±€å¯ç”¨çš„ä¸­é—´ä»¶</span></span><br><span class="line">app.<span class="title function_">use</span>(customBodyParser)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/user&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(req.<span class="property">body</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨ app.listen æ–¹æ³•ï¼ŒæŒ‡å®šç«¯å£å·å¹¶å¯åŠ¨webæœåŠ¡å™¨</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Express server running at http://127.0.0.1&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Express-å†™æ¥å£"><a href="#Express-å†™æ¥å£" class="headerlink" title="Express å†™æ¥å£"></a>Express å†™æ¥å£</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£æè¡¨å•æ•°æ®çš„ä¸­é—´ä»¶</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¿…é¡»åœ¨é…ç½® cors ä¸­é—´ä»¶ä¹‹å‰ï¼Œé…ç½® JSONP çš„æ¥å£</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/api/jsonp&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 1. å¾—åˆ°å‡½æ•°çš„åç§°</span></span><br><span class="line">  <span class="keyword">const</span> funcName = req.<span class="property">query</span>.<span class="property">callback</span></span><br><span class="line">  <span class="comment">// 2. å®šä¹‰è¦å‘é€åˆ°å®¢æˆ·ç«¯çš„æ•°æ®å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">const</span> data = &#123; <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>, <span class="attr">age</span>: <span class="number">22</span> &#125;</span><br><span class="line">  <span class="comment">// 3. æ‹¼æ¥å‡ºä¸€ä¸ªå‡½æ•°çš„è°ƒç”¨</span></span><br><span class="line">  <span class="keyword">const</span> scriptStr = <span class="string">`<span class="subst">$&#123;funcName&#125;</span>(<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(data)&#125;</span>)`</span></span><br><span class="line">  <span class="comment">// 4. æŠŠæ‹¼æ¥çš„å­—ç¬¦ä¸²ï¼Œå“åº”ç»™å®¢æˆ·ç«¯</span></span><br><span class="line">  res.<span class="title function_">send</span>(scriptStr)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸€å®šè¦è·¯ç”±ä¹‹å‰é…ç½® cors ä¸­é—´ä»¶ï¼Œä»è€Œè§£å†³***æ¥å£è·¨åŸŸ***</span></span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>)</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cors</span>())</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¼å…¥è·¯ç”±æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">&#x27;./my-apiRouter&#x27;</span>)</span><br><span class="line"><span class="comment">// æŠŠè·¯ç”±æ¨¡å—æ³¨å†Œåˆ° app ä¸Š</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/api&#x27;</span>, router)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯åŠ¨æœåŠ¡å™¨</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;express server running at http://127.0.0.1&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>è·¯ç”±æ¨¡å— my-apiRouter.jsï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>()</span><br><span class="line"><span class="comment">// æŒ‚è½½è·¯ç”±</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/get&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> query = req.<span class="property">query</span></span><br><span class="line">  res.<span class="title function_">send</span>(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">0</span>, <span class="comment">// 0 è¡¨ç¤ºå¤„ç†æˆåŠŸï¼Œ1 è¡¨ç¤ºå¤„ç†å¤±è´¥</span></span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&#x27;GET è¯·æ±‚æˆåŠŸï¼&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: query, <span class="comment">// éœ€è¦å“åº”ç»™å®¢æˆ·ç«¯çš„æ•°æ®</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/post&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> body = req.<span class="property">body</span></span><br><span class="line">  res.<span class="title function_">send</span>(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&#x27;POST è¯·æ±‚æˆåŠŸï¼&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: body,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// å®šä¹‰ DELETE æ¥å£</span></span><br><span class="line">router.<span class="title function_">delete</span>(<span class="string">&#x27;/delete&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&#x27;DELETEè¯·æ±‚æˆåŠŸ&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router</span><br></pre></td></tr></table></figure>
<p><strong>ä½¿ç”¨ cors ä¸­é—´ä»¶è§£å†³è·¨åŸŸé—®é¢˜</strong><br>cors æ˜¯ Express çš„ä¸€ä¸ªç¬¬ä¸‰æ–¹ä¸­é—´ä»¶ã€‚é€šè¿‡å®‰è£…å’Œé…ç½® cors ä¸­é—´ä»¶ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°è§£å†³è·¨åŸŸé—®é¢˜ã€‚<br>ä½¿ç”¨æ­¥éª¤åˆ†ä¸ºå¦‚ä¸‹ 3 æ­¥ï¼š<br>â‘  è¿è¡Œ npm install cors å®‰è£…ä¸­é—´ä»¶<br>â‘¡ ä½¿ç”¨ const cors = require(â€˜corsâ€™) å¯¼å…¥ä¸­é—´ä»¶<br>â‘¢ åœ¨è·¯ç”±ä¹‹å‰è°ƒç”¨ app.use(cors()) é…ç½®ä¸­é—´ä»¶</p>
<p>CORS ï¼ˆCross-Origin Resource Sharingï¼Œè·¨åŸŸèµ„æºå…±äº«ï¼‰ç”±ä¸€ç³»åˆ— HTTP å“åº”å¤´ç»„æˆï¼Œè¿™äº› HTTP å“åº”å¤´å†³å®šæµè§ˆå™¨æ˜¯å¦é˜»æ­¢å‰ç«¯ JS ä»£ç è·¨åŸŸè·å–èµ„æºã€‚<br>æµè§ˆå™¨çš„åŒæºå®‰å…¨ç­–ç•¥é»˜è®¤ä¼šé˜»æ­¢ç½‘é¡µâ€œè·¨åŸŸâ€è·å–èµ„æºã€‚ä½†å¦‚æœæ¥å£æœåŠ¡å™¨é…ç½®äº† CORS ç›¸å…³çš„ HTTP å“åº”å¤´å°±å¯ä»¥è§£é™¤æµè§ˆå™¨ç«¯çš„è·¨åŸŸè®¿é—®é™åˆ¶ã€‚</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img1.imgtp.com/2022/08/30/pG0rU3f4.png" alt="image-20220830000028687"></p>
<p>CORS ä¸»è¦åœ¨æœåŠ¡å™¨ç«¯è¿›è¡Œé…ç½®ã€‚å®¢æˆ·ç«¯æµè§ˆå™¨æ— é¡»åšä»»ä½•é¢å¤–çš„é…ç½®ï¼Œå³å¯è¯·æ±‚å¼€å¯äº† CORS çš„æ¥å£ã€‚CORS åœ¨æµè§ˆå™¨ä¸­æœ‰å…¼å®¹æ€§ã€‚åªæœ‰æ”¯æŒ XMLHttpRequest Level2 çš„æµè§ˆå™¨ï¼Œæ‰èƒ½æ­£å¸¸è®¿é—®å¼€å¯äº† CORS çš„æœåŠ¡ç«¯æ¥å£.</p>
<hr>
<ol>
<li>CORS å“åº”å¤´éƒ¨ - <strong>Access-Control-Allow-Origin</strong></li>
</ol>
<p>å“åº”å¤´éƒ¨ä¸­å¯ä»¥æºå¸¦ä¸€ä¸ª Access-Control-Allow-Origin å­—æ®µï¼Œå…¶è¯­æ³•å¦‚ä¸‹:</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Origin: &lt;origin&gt; | *</span><br></pre></td></tr></table></figure>
<p>origin å‚æ•°çš„å€¼æŒ‡å®šäº†å…è®¸è®¿é—®è¯¥èµ„æºçš„å¤–åŸŸ URLã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„å­—æ®µå€¼å°†åªå…è®¸æ¥è‡ª <a target="_blank" rel="noopener" href="https://roydon.xyz">https://roydon.xyz</a> çš„è¯·æ±‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>,<span class="string">&#x27;https://roydon.xyz&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæŒ‡å®šäº† Access-Control-Allow-Origin å­—æ®µçš„å€¼ä¸ºé€šé…ç¬¦ *ï¼Œè¡¨ç¤ºå…è®¸æ¥è‡ªä»»ä½•åŸŸçš„è¯·æ±‚ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>,<span class="string">&#x27;*&#x27;</span>)</span><br></pre></td></tr></table></figure>
<ol>
<li>CORS å“åº”å¤´éƒ¨ - <strong>Access-Control-Allow-Headers</strong></li>
</ol>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒCORS ä»…æ”¯æŒå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€å¦‚ä¸‹çš„ 9 ä¸ªè¯·æ±‚å¤´ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Acceptã€Accept-Languageã€Content-Languageã€DPRã€Downlinkã€Save-Dataã€Viewport-Widthã€Width ã€Content-Typeï¼ˆå€¼ä»…é™äº text/plainã€multipart/form-dataã€application/x-www-form-urlencoded ä¸‰è€…ä¹‹ä¸€ï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>å¦‚æœå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€äº†é¢å¤–çš„è¯·æ±‚å¤´ä¿¡æ¯ï¼Œåˆ™éœ€è¦åœ¨æœåŠ¡å™¨ç«¯ï¼Œé€šè¿‡ Access-Control-Allow-Headers å¯¹é¢å¤–çš„è¯·æ±‚å¤´è¿›è¡Œå£°æ˜ï¼Œå¦åˆ™è¿™æ¬¡è¯·æ±‚ä¼šå¤±è´¥ï¼</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.<span class="title function_">serHeader</span>(<span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span>,<span class="string">&#x27;Content-Type,X-Custom-Header&#x27;</span>)</span><br></pre></td></tr></table></figure>
<ol>
<li>CORS å“åº”å¤´éƒ¨ - <strong>Access-Control-Allow-Methods</strong></li>
</ol>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒCORS ä»…æ”¯æŒå®¢æˆ·ç«¯å‘èµ· GETã€POSTã€HEAD è¯·æ±‚ã€‚å¦‚æœå®¢æˆ·ç«¯å¸Œæœ›é€šè¿‡ PUTã€DELETE ç­‰æ–¹å¼è¯·æ±‚æœåŠ¡å™¨çš„èµ„æºï¼Œåˆ™éœ€è¦åœ¨æœåŠ¡å™¨ç«¯ï¼Œé€šè¿‡ Access-Control-Alow-Methodsæ¥æŒ‡æ˜å®é™…è¯·æ±‚æ‰€å…è®¸ä½¿ç”¨çš„ HTTP æ–¹æ³•ã€‚<br>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res.<span class="title function_">serHeader</span>(<span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span>,<span class="string">&#x27;GET,POST,DELETE,HEAD&#x27;</span>)</span><br><span class="line"><span class="comment">// å…è®¸æ‰€æœ‰è¯·æ±‚</span></span><br><span class="line">res.<span class="title function_">serHeader</span>(<span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span>,<span class="string">&#x27;*&#x27;</span>)</span><br></pre></td></tr></table></figure>
<hr>
<p>CORSè¯·æ±‚çš„åˆ†ç±»<br>å®¢æˆ·ç«¯åœ¨è¯·æ±‚ CORS æ¥å£æ—¶ï¼Œæ ¹æ®è¯·æ±‚æ–¹å¼å’Œè¯·æ±‚å¤´çš„ä¸åŒï¼Œå¯ä»¥å°† CORS çš„è¯·æ±‚åˆ†ä¸ºä¸¤å¤§ç±»ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>â‘  ç®€å•è¯·æ±‚</li>
</ul>
<p>åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤å¤§æ¡ä»¶çš„è¯·æ±‚ï¼Œå°±å±äºç®€å•è¯·æ±‚ï¼š<br>â‘  è¯·æ±‚æ–¹å¼ï¼šGETã€POSTã€HEAD ä¸‰è€…ä¹‹ä¸€<br>â‘¡ HTTP å¤´éƒ¨ä¿¡æ¯ä¸è¶…è¿‡ä»¥ä¸‹å‡ ç§å­—æ®µï¼šæ— è‡ªå®šä¹‰å¤´éƒ¨å­—æ®µã€Acceptã€Accept-Languageã€Content-Languageã€DPRã€<br>Downlinkã€Save-Dataã€Viewport-Widthã€Width ã€Content-Typeï¼ˆåªæœ‰ä¸‰ä¸ªå€¼application/x-www-form-<br>urlencodedã€multipart/form-dataã€text/plainï¼‰</p>
<ul>
<li>â‘¡ é¢„æ£€è¯·æ±‚</li>
</ul>
<p>åªè¦ç¬¦åˆä»¥ä¸‹ä»»ä½•ä¸€ä¸ªæ¡ä»¶çš„è¯·æ±‚ï¼Œéƒ½éœ€è¦è¿›è¡Œé¢„æ£€è¯·æ±‚ï¼š<br>â‘  è¯·æ±‚æ–¹å¼ä¸º GETã€POSTã€HEAD ä¹‹å¤–çš„è¯·æ±‚ Method ç±»å‹<br>â‘¡ è¯·æ±‚å¤´ä¸­åŒ…å«è‡ªå®šä¹‰å¤´éƒ¨å­—æ®µ<br>â‘¢ å‘æœåŠ¡å™¨å‘é€äº† application/json æ ¼å¼çš„æ•°æ®<br>åœ¨æµè§ˆå™¨ä¸æœåŠ¡å™¨æ­£å¼é€šä¿¡ä¹‹å‰ï¼Œæµè§ˆå™¨ä¼šå…ˆå‘é€ OPTION è¯·æ±‚è¿›è¡Œé¢„æ£€ï¼Œä»¥è·çŸ¥æœåŠ¡å™¨æ˜¯å¦å…è®¸è¯¥å®é™…è¯·æ±‚ï¼Œæ‰€ä»¥è¿™ä¸€<br>æ¬¡çš„ OPTION è¯·æ±‚ç§°ä¸ºâ€œé¢„æ£€è¯·æ±‚â€ã€‚æœåŠ¡å™¨æˆåŠŸå“åº”é¢„æ£€è¯·æ±‚åï¼Œæ‰ä¼šå‘é€çœŸæ­£çš„è¯·æ±‚ï¼Œå¹¶ä¸”æºå¸¦çœŸå®æ•°æ®ã€‚</p>
<hr>
<h1 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h1><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><p>ç»„ç»‡ã€å­˜å‚¨å’Œç®¡ç†æ•°æ®çš„ä»“åº“ã€‚</p>
<p>é™¤äº†æ–‡æœ¬ç±»å‹çš„æ•°æ®ï¼Œå›¾åƒã€éŸ³ä¹ã€å£°éŸ³éƒ½æ˜¯æ•°æ®ã€‚</p>
<p>åŸºæœ¬æ“ä½œï¼šå¢åˆ æŸ¥æ”¹ã€‚</p>
<p>æ¨èï¼š    Mysqlï¼ˆå…³ç³»å‹æ•°æ®åº“</p>
<p>éœ€è¦å‰æçŸ¥è¯†æ•°æ®åº“ï¼ˆç”±äºæˆ‘åšçš„æ˜¯åç«¯ï¼Œäº†è§£æ•°æ®åº“ï¼‰ï¼Œæ­¤å¤„ä¸å¤šèµ˜è¿°ï¼Œç›´æ¥è¿›è¡Œnodeæ•´åˆmysqlã€‚å¢åˆ æŸ¥æ”¹ç­‰Sqlè¯­å¥è‡ªè¡Œç™¾åº¦ã€‚</p>
<p>ğŸ¥°ğŸ¥°</p>
<h2 id="nodeæ•´åˆmysql"><a href="#nodeæ•´åˆmysql" class="headerlink" title="nodeæ•´åˆmysql"></a>nodeæ•´åˆmysql</h2><p>æ­¥éª¤ï¼š</p>
<p>â‘  å®‰è£…æ“ä½œ MySQL æ•°æ®åº“çš„ç¬¬ä¸‰æ–¹æ¨¡å—ï¼ˆmysqlï¼‰</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i mysql</span><br></pre></td></tr></table></figure>
<p>â‘¡ é€šè¿‡ mysql æ¨¡å—è¿æ¥åˆ° MySQL æ•°æ®åº“</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. å¯¼å…¥ mysql æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql&#x27;</span>)</span><br><span class="line"><span class="comment">// 2. å»ºç«‹ä¸ MySQL æ•°æ®åº“çš„è¿æ¥å…³ç³»</span></span><br><span class="line"><span class="keyword">const</span> db = mysql.<span class="title function_">createPool</span>(&#123;</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="comment">// æ•°æ®åº“çš„ IP åœ°å€</span></span><br><span class="line">  <span class="attr">user</span>: <span class="string">&#x27;root&#x27;</span>, <span class="comment">// ç™»å½•æ•°æ®åº“çš„è´¦å·</span></span><br><span class="line">  <span class="attr">password</span>: <span class="string">&#x27;qwer1234&#x27;</span>, <span class="comment">// ç™»å½•æ•°æ®åº“çš„å¯†ç </span></span><br><span class="line">  <span class="attr">database</span>: <span class="string">&#x27;db_1&#x27;</span>, <span class="comment">// æŒ‡å®šè¦æ“ä½œå“ªä¸ªæ•°æ®åº“</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>â‘¢ é€šè¿‡ mysql æ¨¡å—æ‰§è¡Œ SQL è¯­å¥<br>ä¸‹é¢ä¾æ¬¡ä¸¾ä¾‹ï¼ˆæŸ¥æ‰¾ã€å¢åŠ ã€ä¿®æ”¹ã€åˆ é™¤ï¼‰å››é¡¹ï¼šæ•°æ®è¡¨ä¸º users</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.æŸ¥æ‰¾</span></span><br><span class="line"><span class="keyword">const</span> sqlStr = <span class="string">&#x27;select * from users&#x27;</span></span><br><span class="line">db.<span class="title function_">query</span>(sqlStr, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// æŸ¥è¯¢æ•°æ®å¤±è´¥</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">message</span>)</span><br><span class="line">  <span class="comment">// æŸ¥è¯¢æ•°æ®æˆåŠŸ</span></span><br><span class="line">  <span class="comment">// æ³¨æ„ï¼šå¦‚æœæ‰§è¡Œçš„æ˜¯ select æŸ¥è¯¢è¯­å¥ï¼Œåˆ™æ‰§è¡Œçš„ç»“æœæ˜¯æ•°ç»„</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(results)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2.å¢åŠ </span></span><br><span class="line"><span class="comment">// å†™æ³•ä¸€ï¼š******************</span></span><br><span class="line"><span class="keyword">const</span> user = &#123; <span class="attr">username</span>: <span class="string">&#x27;guo&#x27;</span>, <span class="attr">password</span>: <span class="string">&#x27;123&#x27;</span> &#125;</span><br><span class="line"><span class="comment">// å®šä¹‰å¾…æ‰§è¡Œçš„ SQL è¯­å¥</span></span><br><span class="line"><span class="keyword">const</span> sqlStr = <span class="string">&#x27;insert into users (username, password) values (?, ?)&#x27;</span></span><br><span class="line"><span class="comment">// æ‰§è¡Œ SQL è¯­å¥</span></span><br><span class="line">db.<span class="title function_">query</span>(sqlStr, [user.<span class="property">username</span>, user.<span class="property">password</span>], <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// æ‰§è¡Œ SQL è¯­å¥å¤±è´¥äº†</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">message</span>)</span><br><span class="line">  <span class="comment">// æˆåŠŸäº†</span></span><br><span class="line">  <span class="comment">// æ³¨æ„ï¼šå¦‚æœæ‰§è¡Œçš„æ˜¯ insert into æ’å…¥è¯­å¥ï¼Œåˆ™ results æ˜¯ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">  <span class="comment">// å¯ä»¥é€šè¿‡ affectedRows å±æ€§ï¼Œæ¥åˆ¤æ–­æ˜¯å¦æ’å…¥æ•°æ®æˆåŠŸ</span></span><br><span class="line">  <span class="keyword">if</span> (results.<span class="property">affectedRows</span> === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;æ’å…¥æ•°æ®æˆåŠŸ!&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// å†™æ³•äºŒï¼šæ¨è**********************</span></span><br><span class="line"><span class="keyword">const</span> user = &#123; <span class="attr">username</span>: <span class="string">&#x27;roydon&#x27;</span>, <span class="attr">password</span>: <span class="string">&#x27;123456&#x27;</span> &#125;</span><br><span class="line"><span class="comment">// æ’å…¥çš„ SQL è¯­å¥ï¼Œ? ä¸ºå ä½ç¬¦</span></span><br><span class="line"><span class="keyword">const</span> sqlStr = <span class="string">&#x27;insert into users set ?&#x27;</span></span><br><span class="line"><span class="comment">// æ‰§è¡Œ SQL è¯­å¥</span></span><br><span class="line">db.<span class="title function_">query</span>(sqlStr, user, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">message</span>)</span><br><span class="line">  <span class="keyword">if</span> (results.<span class="property">affectedRows</span> === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;æ’å…¥æ•°æ®æˆåŠŸ&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3.ä¿®æ”¹(æ›´æ–°)</span></span><br><span class="line"><span class="comment">// å†™æ³•ä¸€ï¼š********************</span></span><br><span class="line"><span class="keyword">const</span> user = &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">username</span>: <span class="string">&#x27;aaa&#x27;</span>, <span class="attr">password</span>: <span class="string">&#x27;000&#x27;</span> &#125;</span><br><span class="line"><span class="comment">// å®šä¹‰ SQL è¯­å¥</span></span><br><span class="line"><span class="keyword">const</span> sqlStr = <span class="string">&#x27;update users set username=?, password=? where id=?&#x27;</span></span><br><span class="line"><span class="comment">// æ‰§è¡Œ SQL è¯­å¥</span></span><br><span class="line">db.<span class="title function_">query</span>(sqlStr, [user.<span class="property">username</span>, user.<span class="property">password</span>, user.<span class="property">id</span>], <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">message</span>)</span><br><span class="line">  <span class="comment">// æ³¨æ„ï¼šæ‰§è¡Œäº† update è¯­å¥ä¹‹åï¼Œæ‰§è¡Œçš„ç»“æœï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡ affectedRows åˆ¤æ–­æ˜¯å¦æ›´æ–°æˆåŠŸ</span></span><br><span class="line">  <span class="keyword">if</span> (results.<span class="property">affectedRows</span> === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;æ›´æ–°æˆåŠŸ&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// å†™æ³•äºŒï¼š(æ¨è)****************</span></span><br><span class="line"><span class="keyword">const</span> user = &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">username</span>: <span class="string">&#x27;bbb&#x27;</span>, <span class="attr">password</span>: <span class="string">&#x27;111&#x27;</span> &#125;</span><br><span class="line"><span class="comment">// å®šä¹‰ SQL è¯­å¥</span></span><br><span class="line"><span class="keyword">const</span> sqlStr = <span class="string">&#x27;update users set ? where id=?&#x27;</span></span><br><span class="line"><span class="comment">// æ‰§è¡Œ SQL è¯­å¥</span></span><br><span class="line">db.<span class="title function_">query</span>(sqlStr, [user, user.<span class="property">id</span>], <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">message</span>)</span><br><span class="line">  <span class="keyword">if</span> (results.<span class="property">affectedRows</span> === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;æ›´æ–°æ•°æ®æˆåŠŸ&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4.åˆ é™¤</span></span><br><span class="line"><span class="keyword">const</span> sqlStr = <span class="string">&#x27;delete from users where id=?&#x27;</span></span><br><span class="line">db.<span class="title function_">query</span>(sqlStr, <span class="number">2</span>, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">message</span>)</span><br><span class="line">  <span class="comment">// æ³¨æ„ï¼šæ‰§è¡Œ delete è¯­å¥ä¹‹åï¼Œç»“æœä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿä¼šåŒ…å« affectedRows å±æ€§</span></span><br><span class="line">  <span class="keyword">if</span> (results.<span class="property">affectedRows</span> === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;åˆ é™¤æ•°æ®æˆåŠŸ&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="å‰åç«¯çš„èº«ä»½è®¤è¯"><a href="#å‰åç«¯çš„èº«ä»½è®¤è¯" class="headerlink" title="å‰åç«¯çš„èº«ä»½è®¤è¯"></a>å‰åç«¯çš„èº«ä»½è®¤è¯</h1><p>ç›®å‰ä¸»æµçš„ Web å¼€å‘æ¨¡å¼æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ol>
<li>æœåŠ¡ç«¯æ¸²æŸ“çš„ä¼ ç»Ÿ Web å¼€å‘æ¨¡å¼</li>
</ol>
<p>æœåŠ¡ç«¯æ¸²æŸ“çš„æ¦‚å¿µï¼šæœåŠ¡å™¨å‘é€ç»™å®¢æˆ·ç«¯çš„ HTML é¡µé¢ï¼Œæ˜¯åœ¨æœåŠ¡å™¨é€šè¿‡å­—ç¬¦ä¸²çš„æ‹¼æ¥ï¼ŒåŠ¨æ€ç”Ÿæˆçš„ã€‚å› æ­¤ï¼Œå®¢æˆ·ç«¯ä¸<br>éœ€è¦ä½¿ç”¨ Ajax è¿™æ ·çš„æŠ€æœ¯é¢å¤–è¯·æ±‚é¡µé¢çš„æ•°æ®ã€‚</p>
<blockquote>
<p>æœåŠ¡ç«¯æ¸²æŸ“çš„ä¼˜ç¼ºç‚¹<br>ä¼˜ç‚¹ï¼š<br>â‘  å‰ç«¯è€—æ—¶å°‘ã€‚å› ä¸ºæœåŠ¡å™¨ç«¯è´Ÿè´£åŠ¨æ€ç”Ÿæˆ HTML å†…å®¹ï¼Œæµè§ˆå™¨åªéœ€è¦ç›´æ¥æ¸²æŸ“é¡µé¢å³å¯ã€‚å°¤å…¶æ˜¯ç§»åŠ¨ç«¯ï¼Œæ›´çœç”µã€‚<br>â‘¡ æœ‰åˆ©äºSEOã€‚å› ä¸ºæœåŠ¡å™¨ç«¯å“åº”çš„æ˜¯å®Œæ•´çš„ HTML é¡µé¢å†…å®¹ï¼Œæ‰€ä»¥çˆ¬è™«æ›´å®¹æ˜“çˆ¬å–è·å¾—ä¿¡æ¯ï¼Œæ›´æœ‰åˆ©äº SEOã€‚<br>ç¼ºç‚¹ï¼š<br>â‘  å ç”¨æœåŠ¡å™¨ç«¯èµ„æºã€‚å³æœåŠ¡å™¨ç«¯å®Œæˆ HTML é¡µé¢å†…å®¹çš„æ‹¼æ¥ï¼Œå¦‚æœè¯·æ±‚è¾ƒå¤šï¼Œä¼šå¯¹æœåŠ¡å™¨é€ æˆä¸€å®šçš„è®¿é—®å‹åŠ›ã€‚<br>â‘¡ ä¸åˆ©äºå‰åç«¯åˆ†ç¦»ï¼Œå¼€å‘æ•ˆç‡ä½ã€‚ä½¿ç”¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œåˆ™æ— æ³•è¿›è¡Œåˆ†å·¥åˆä½œï¼Œå°¤å…¶å¯¹äºå‰ç«¯å¤æ‚åº¦é«˜çš„é¡¹ç›®ï¼Œä¸åˆ©äº<br>é¡¹ç›®é«˜æ•ˆå¼€å‘ã€‚</p>
</blockquote>
<ol>
<li>å‰åç«¯åˆ†ç¦»çš„æ–°å‹ Web å¼€å‘æ¨¡å¼</li>
</ol>
<p>å‰åç«¯åˆ†ç¦»çš„æ¦‚å¿µï¼šå‰åç«¯åˆ†ç¦»çš„å¼€å‘æ¨¡å¼ï¼Œä¾èµ–äº Ajax æŠ€æœ¯çš„å¹¿æ³›åº”ç”¨ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå‰åç«¯åˆ†ç¦»çš„ Web å¼€å‘æ¨¡å¼ï¼Œ<br>å°±æ˜¯åç«¯åªè´Ÿè´£æä¾› API æ¥å£ï¼Œå‰ç«¯ä½¿ç”¨ Ajax è°ƒç”¨æ¥å£æŠŠæ•°æ®æ¸²æŸ“åˆ°é¡µé¢ä¸Šçš„å¼€å‘æ¨¡å¼ã€‚</p>
<blockquote>
<p>å‰åç«¯åˆ†ç¦»çš„ä¼˜ç¼ºç‚¹<br>ä¼˜ç‚¹ï¼š<br>â‘  å¼€å‘ä½“éªŒå¥½ã€‚å‰ç«¯ä¸“æ³¨äº UI é¡µé¢çš„å¼€å‘ï¼Œåç«¯ä¸“æ³¨äºapi çš„å¼€å‘ï¼Œä¸”å‰ç«¯æœ‰æ›´å¤šçš„é€‰æ‹©æ€§ã€‚<br>â‘¡ ç”¨æˆ·ä½“éªŒå¥½ã€‚Ajax æŠ€æœ¯çš„å¹¿æ³›åº”ç”¨ï¼Œæå¤§çš„æé«˜äº†ç”¨æˆ·çš„ä½“éªŒï¼Œå¯ä»¥è½»æ¾å®ç°é¡µé¢çš„å±€éƒ¨åˆ·æ–°ã€‚<br>â‘¢ å‡è½»äº†æœåŠ¡å™¨ç«¯çš„æ¸²æŸ“å‹åŠ›ã€‚å› ä¸ºé¡µé¢æœ€ç»ˆæ˜¯åœ¨æ¯ä¸ªç”¨æˆ·çš„æµè§ˆå™¨ä¸­ç”Ÿæˆçš„ã€‚<br>ç¼ºç‚¹ï¼š<br>â‘  ä¸åˆ©äº SEOã€‚å› ä¸ºå®Œæ•´çš„ HTML é¡µé¢éœ€è¦åœ¨å®¢æˆ·ç«¯åŠ¨æ€æ‹¼æ¥å®Œæˆï¼Œæ‰€ä»¥çˆ¬è™«å¯¹æ— æ³•çˆ¬å–é¡µé¢çš„æœ‰æ•ˆä¿¡æ¯ã€‚ï¼ˆè§£å†³æ–¹<br>æ¡ˆï¼šåˆ©ç”¨ Vueã€React ç­‰å‰ç«¯æ¡†æ¶çš„ SSR ï¼ˆserver side renderï¼‰æŠ€æœ¯èƒ½å¤Ÿå¾ˆå¥½çš„è§£å†³ SEO é—®é¢˜ï¼ï¼‰</p>
</blockquote>
<h2 id="èº«ä»½è®¤è¯ï¼š"><a href="#èº«ä»½è®¤è¯ï¼š" class="headerlink" title="èº«ä»½è®¤è¯ï¼š"></a>èº«ä»½è®¤è¯ï¼š</h2><p>èº«ä»½è®¤è¯ï¼ˆAuthenticationï¼‰åˆç§°â€œèº«ä»½éªŒè¯â€ã€â€œé‰´æƒâ€ï¼Œæ˜¯æŒ‡é€šè¿‡ä¸€å®šçš„æ‰‹æ®µï¼Œå®Œæˆå¯¹ç”¨æˆ·èº«ä»½çš„ç¡®è®¤ã€‚<br>ç¡®ä¿æ˜¯æ­¤ç”¨æˆ·ç™»å½•ã€‚</p>
<p>å¯¹äºæœåŠ¡ç«¯æ¸²æŸ“å’Œå‰åç«¯åˆ†ç¦»è¿™ä¸¤ç§å¼€å‘æ¨¡å¼æ¥è¯´ï¼Œåˆ†åˆ«æœ‰ç€ä¸åŒçš„èº«ä»½è®¤è¯æ–¹æ¡ˆï¼š<br><strong>æœåŠ¡ç«¯æ¸²æŸ“æ¨èä½¿ç”¨ Session è®¤è¯æœºåˆ¶</strong>.</p>
<p>å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è¯·æ±‚æœåŠ¡å™¨çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨é€šè¿‡å“åº”å¤´çš„å½¢å¼ï¼Œå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªèº«ä»½è®¤è¯çš„ Cookieï¼Œå®¢æˆ·ç«¯ä¼šè‡ªåŠ¨å°† Cookie ä¿å­˜åœ¨æµè§ˆå™¨ä¸­ã€‚éšåï¼Œå½“å®¢æˆ·ç«¯æµè§ˆå™¨æ¯æ¬¡è¯·æ±‚æœåŠ¡å™¨çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å°†èº«ä»½è®¤è¯ç›¸å…³çš„ Cookieï¼Œé€šè¿‡è¯·æ±‚å¤´çš„å½¢å¼å‘é€ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å³å¯éªŒæ˜å®¢æˆ·ç«¯çš„èº«ä»½ã€‚</p>
<p>Cookie æ˜¯å­˜å‚¨åœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­çš„ä¸€æ®µä¸è¶…è¿‡ 4 KB çš„å­—ç¬¦ä¸²ã€‚å®ƒç”±ä¸€ä¸ªåç§°ï¼ˆNameï¼‰ã€ä¸€ä¸ªå€¼ï¼ˆValueï¼‰å’Œå…¶å®ƒå‡ ä¸ªç”¨äºæ§åˆ¶ Cookie æœ‰æ•ˆæœŸã€å®‰å…¨æ€§ã€ä½¿ç”¨èŒƒå›´çš„å¯é€‰å±æ€§ç»„æˆã€‚ä¸åŒåŸŸåä¸‹çš„ Cookie å„è‡ªç‹¬ç«‹ï¼Œæ¯å½“å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚æ—¶ï¼Œä¼šè‡ªåŠ¨æŠŠå½“å‰åŸŸåä¸‹æ‰€æœ‰æœªè¿‡æœŸçš„ Cookie ä¸€åŒå‘é€åˆ°æœåŠ¡å™¨ã€‚<br>ç”±äº Cookie æ˜¯å­˜å‚¨åœ¨æµè§ˆå™¨ä¸­çš„ï¼Œè€Œä¸”æµè§ˆå™¨ä¹Ÿæä¾›äº†è¯»å†™ Cookie çš„ APIï¼Œå› æ­¤ Cookie å¾ˆå®¹æ˜“è¢«ä¼ªé€ ï¼Œä¸å…·æœ‰å®‰å…¨æ€§ã€‚å› æ­¤ä¸å»ºè®®æœåŠ¡å™¨å°†é‡è¦çš„éšç§æ•°æ®ï¼Œé€šè¿‡ Cookie çš„å½¢å¼å‘é€ç»™æµè§ˆå™¨ã€‚</p>
<p>Session çš„å·¥ä½œåŸç†ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img1.imgtp.com/2022/08/30/kUmHTFh8.png" alt=""></p>
<h2 id="Express-ä½¿ç”¨-Session-è®¤è¯"><a href="#Express-ä½¿ç”¨-Session-è®¤è¯" class="headerlink" title="Express ä½¿ç”¨ Session è®¤è¯"></a>Express ä½¿ç”¨ Session è®¤è¯</h2><ol>
<li>å®‰è£… express-session æ’ä»¶</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i express-session</span><br></pre></td></tr></table></figure>
<ol>
<li><p>é…ç½® express-session ä¸­é—´ä»¶</p>
<p>é€šè¿‡ app.use() æ¥æ³¨å†Œ session ä¸­é—´ä»¶:</p>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&#x27;express-session&#x27;</span>)</span><br><span class="line">app.<span class="title function_">use</span>(</span><br><span class="line">  <span class="title function_">session</span>(&#123;</span><br><span class="line">    <span class="attr">secret</span>: <span class="string">&#x27;roydon&#x27;</span>,	<span class="comment">// è‡ªå®šä¹‰å­—ç¬¦ç©¿</span></span><br><span class="line">    <span class="attr">resave</span>: <span class="literal">false</span>,		<span class="comment">// å›ºå®šå†™æ³•</span></span><br><span class="line">    <span class="attr">saveUninitialized</span>: <span class="literal">true</span>, <span class="comment">// å›ºå®šå†™æ³•</span></span><br><span class="line">  &#125;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ol>
<li>å‘ session ä¸­å­˜æ•°æ®</li>
</ol>
<p>é€šè¿‡ req.session æ¥è®¿é—®å’Œä½¿ç”¨ session å¯¹è±¡ï¼Œä»è€Œå­˜å‚¨ç”¨æˆ·çš„å…³é”®ä¿¡æ¯ï¼š</p>
<p>ä¾‹å¦‚ä¸‹é¢çš„ç™»å½•æ¥å£ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/api/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// åˆ¤æ–­ç”¨æˆ·æäº¤çš„ç™»å½•ä¿¡æ¯æ˜¯å¦æ­£ç¡®</span></span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">body</span>.<span class="property">username</span> !== <span class="string">&#x27;admin&#x27;</span> || req.<span class="property">body</span>.<span class="property">password</span> !== <span class="string">&#x27;000000&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">send</span>(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">msg</span>: <span class="string">&#x27;ç™»å½•å¤±è´¥&#x27;</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å°†ç™»å½•æˆåŠŸåçš„ç”¨æˆ·ä¿¡æ¯ï¼Œä¿å­˜åˆ° Session ä¸­</span></span><br><span class="line">  req.<span class="property">session</span>.<span class="property">user</span> = req.<span class="property">body</span> <span class="comment">// ç”¨æˆ·çš„ä¿¡æ¯</span></span><br><span class="line">  req.<span class="property">session</span>.<span class="property">islogin</span> = <span class="literal">true</span> <span class="comment">// ç”¨æˆ·çš„ç™»å½•çŠ¶æ€</span></span><br><span class="line"></span><br><span class="line">  res.<span class="title function_">send</span>(&#123; <span class="attr">status</span>: <span class="number">0</span>, <span class="attr">msg</span>: <span class="string">&#x27;ç™»å½•æˆåŠŸ&#x27;</span> &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>ä» session ä¸­å–æ•°æ®</li>
</ol>
<p>å¯ä»¥ç›´æ¥ä» req.session å¯¹è±¡ä¸Šè·å–ä¹‹å‰å­˜å‚¨çš„æ•°æ®ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/api/username&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ä» Session ä¸­è·å–ç”¨æˆ·çš„åç§°ï¼Œå“åº”ç»™å®¢æˆ·ç«¯</span></span><br><span class="line">  <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">islogin</span>) &#123;</span><br><span class="line">    <span class="comment">// session éªŒè¯å¤±è´¥</span></span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">send</span>(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">msg</span>: <span class="string">&#x27;fail&#x27;</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  res.<span class="title function_">send</span>(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">    <span class="attr">username</span>: req.<span class="property">session</span>.<span class="property">user</span>.<span class="property">username</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>æ¸…ç©º Session ä¿¡æ¯ï¼šreq.session.destroy()</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/api/logout&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// æ¸…ç©º Session ä¿¡æ¯</span></span><br><span class="line">  req.<span class="property">session</span>.<span class="title function_">destroy</span>()</span><br><span class="line">  res.<span class="title function_">send</span>(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&#x27;é€€å‡ºç™»å½•æˆåŠŸ&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å±€é™æ€§ï¼š</p>
<p>Session è®¤è¯æœºåˆ¶éœ€è¦é…åˆ Cookie æ‰èƒ½å®ç°ã€‚ç”±äº Cookie é»˜è®¤ä¸æ”¯æŒè·¨åŸŸè®¿é—®ï¼Œæ‰€ä»¥ï¼Œå½“æ¶‰åŠåˆ°å‰ç«¯è·¨åŸŸè¯·æ±‚åç«¯æ¥<br>å£çš„æ—¶å€™ï¼Œéœ€è¦åšå¾ˆå¤šé¢å¤–çš„é…ç½®ï¼Œæ‰èƒ½å®ç°è·¨åŸŸ Session è®¤è¯ã€‚<br>æ³¨æ„ï¼š<br>âš« å½“å‰ç«¯è¯·æ±‚åç«¯æ¥å£ä¸å­˜åœ¨è·¨åŸŸé—®é¢˜çš„æ—¶å€™ï¼Œæ¨èä½¿ç”¨ Session èº«ä»½è®¤è¯æœºåˆ¶ã€‚<br>âš« å½“å‰ç«¯éœ€è¦è·¨åŸŸè¯·æ±‚åç«¯æ¥å£çš„æ—¶å€™ï¼Œä¸æ¨èä½¿ç”¨ Session èº«ä»½è®¤è¯æœºåˆ¶ï¼Œæ¨èä½¿ç”¨ JWT è®¤è¯æœºåˆ¶ã€‚</p>
</blockquote>
<hr>
<h2 id="Express-ä½¿ç”¨-JWT"><a href="#Express-ä½¿ç”¨-JWT" class="headerlink" title="Express ä½¿ç”¨ JWT"></a>Express ä½¿ç”¨ JWT</h2><p>JWTï¼ˆè‹±æ–‡å…¨ç§°ï¼šJSON Web Tokenï¼‰æ˜¯ç›®å‰æœ€æµè¡Œçš„è·¨åŸŸè®¤è¯è§£å†³æ–¹æ¡ˆ</p>
<p>å‰åç«¯åˆ†ç¦»æ¨èä½¿ç”¨ JWT è®¤è¯æœºåˆ¶</p>
<p>JWT çš„å·¥ä½œåŸç†ï¼šç”¨æˆ·ä¿¡æ¯é€šè¿‡ Token å­—ç¬¦ä¸²çš„å½¢å¼ï¼Œä¿å­˜åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨ä¸­ã€‚æœåŠ¡å™¨é€šè¿‡è¿˜åŸ Token å­—ç¬¦ä¸²çš„å½¢å¼æ¥è®¤è¯ç”¨æˆ·çš„èº«ä»½ã€‚</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img1.imgtp.com/2022/08/30/f6Q43c6D.png" alt=""></p>
<p>JWT é€šå¸¸ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯ Headerï¼ˆå¤´éƒ¨ï¼‰ã€Payloadï¼ˆæœ‰æ•ˆè·è½½ï¼‰ã€Signatureï¼ˆç­¾åï¼‰ã€‚<br>ä¸‰è€…ä¹‹é—´ä½¿ç”¨è‹±æ–‡çš„â€œ.â€åˆ†éš”ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Header.Payload.Signature</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Payload éƒ¨åˆ†æ˜¯çœŸæ­£çš„ç”¨æˆ·ä¿¡æ¯ï¼Œå®ƒæ˜¯ç”¨æˆ·ä¿¡æ¯ç»è¿‡åŠ å¯†ä¹‹åç”Ÿæˆçš„å­—ç¬¦ä¸²ã€‚<br>Header å’Œ Signature æ˜¯å®‰å…¨æ€§ç›¸å…³çš„éƒ¨åˆ†ï¼Œåªæ˜¯ä¸ºäº†ä¿è¯ Token çš„å®‰å…¨æ€§ã€‚</p>
</blockquote>
<p>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨è¿”å›çš„ JWT ä¹‹åï¼Œé€šå¸¸ä¼šå°†å®ƒå‚¨å­˜åœ¨ localStorage æˆ– sessionStorage ä¸­ã€‚<br>æ­¤åï¼Œå®¢æˆ·ç«¯æ¯æ¬¡ä¸æœåŠ¡å™¨é€šä¿¡ï¼Œéƒ½è¦å¸¦ä¸Šè¿™ä¸ª JWT çš„å­—ç¬¦ä¸²ï¼Œä»è€Œè¿›è¡Œèº«ä»½è®¤è¯ã€‚æ¨èçš„åšæ³•æ˜¯æŠŠ JWT æ”¾åœ¨ HTTP <strong>è¯·æ±‚å¤´çš„ Authorization å­—æ®µ</strong>ä¸­ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Authorization: Bearer &lt;token&gt;</span><br></pre></td></tr></table></figure>
<p>Express ä¸­ä½¿ç”¨ JWTï¼š</p>
<ol>
<li><p>å®‰è£…åŒ…ï¼Œå¯¼å…¥åŒ…</p>
<p>jsonwebtoken ç”¨äºç”Ÿæˆ JWT å­—ç¬¦ä¸²ã€‚express-jwt ç”¨äºå°† JWT å­—ç¬¦ä¸²è§£æè¿˜åŸæˆ JSON å¯¹è±¡</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i jsonwebtoken express-jwt</span><br></pre></td></tr></table></figure>
<ol>
<li>å¦‚ä¸‹ï¼šï¼ˆæ’ä»¶è€ç‰ˆæœ¬å†™æ³•å¦‚ä¸‹ï¼‰</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.å®‰è£…å¹¶å¯¼å…¥ JWT ç›¸å…³çš„ä¸¤ä¸ªåŒ…ï¼Œåˆ†åˆ«æ˜¯ jsonwebtoken å’Œ express-jwt</span></span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> expressJWT = <span class="built_in">require</span>(<span class="string">&#x27;express-jwt&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…è®¸è·¨åŸŸèµ„æºå…±äº«</span></span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>)</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cors</span>())</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£æ post è¡¨å•æ•°æ®çš„ä¸­é—´ä»¶</span></span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>)</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.å®šä¹‰ secret å¯†é’¥ï¼Œå»ºè®®å°†å¯†é’¥å‘½åä¸º secretKey ï¼Œå€¼è‡ªå®šä¹‰</span></span><br><span class="line"><span class="keyword">const</span> secretKey = <span class="string">&#x27;i am roydon&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.æ³¨å†Œå°† JWT å­—ç¬¦ä¸²è§£æè¿˜åŸæˆ JSON å¯¹è±¡çš„ä¸­é—´ä»¶</span></span><br><span class="line"><span class="comment">// æ³¨æ„ï¼šåªè¦é…ç½®æˆåŠŸäº† express-jwt è¿™ä¸ªä¸­é—´ä»¶ï¼Œå°±å¯ä»¥æŠŠè§£æå‡ºæ¥çš„ç”¨æˆ·ä¿¡æ¯ï¼ŒæŒ‚è½½åˆ° req.user å±æ€§ä¸Š</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">expressJWT</span>(&#123; <span class="attr">secret</span>: secretKey &#125;).<span class="title function_">unless</span>(&#123; <span class="attr">path</span>: [<span class="regexp">/^\/api\//</span>] &#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç™»å½•æ¥å£</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/api/login&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="comment">// å°† req.body è¯·æ±‚ä½“ä¸­çš„æ•°æ®ï¼Œè½¬å­˜ä¸º userinfo å¸¸é‡</span></span><br><span class="line">  <span class="keyword">const</span> userinfo = req.<span class="property">body</span></span><br><span class="line">  <span class="comment">// ç™»å½•å¤±è´¥</span></span><br><span class="line">  <span class="keyword">if</span> (userinfo.<span class="property">username</span> !== <span class="string">&#x27;admin&#x27;</span> || userinfo.<span class="property">password</span> !== <span class="string">&#x27;000000&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">send</span>(&#123;</span><br><span class="line">      <span class="attr">status</span>: <span class="number">400</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;ç™»å½•å¤±è´¥ï¼&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ç™»å½•æˆåŠŸ</span></span><br><span class="line">  <span class="comment">// 3.åœ¨ç™»å½•æˆåŠŸä¹‹åï¼Œè°ƒç”¨ jwt.sign() æ–¹æ³•ç”Ÿæˆ JWT å­—ç¬¦ä¸²ã€‚å¹¶é€šè¿‡ token å±æ€§å‘é€ç»™å®¢æˆ·ç«¯</span></span><br><span class="line">  <span class="comment">// å‚æ•°1ï¼šç”¨æˆ·çš„ä¿¡æ¯å¯¹è±¡</span></span><br><span class="line">  <span class="comment">// å‚æ•°2ï¼šåŠ å¯†çš„ç§˜é’¥</span></span><br><span class="line">  <span class="comment">// å‚æ•°3ï¼šé…ç½®å¯¹è±¡ï¼Œå¯ä»¥é…ç½®å½“å‰ token çš„æœ‰æ•ˆæœŸ</span></span><br><span class="line">  <span class="comment">// è®°ä½ï¼šåƒä¸‡ä¸è¦æŠŠå¯†ç åŠ å¯†åˆ° token å­—ç¬¦ä¸­</span></span><br><span class="line">  <span class="keyword">const</span> tokenStr = jwt.<span class="title function_">sign</span>(&#123; <span class="attr">username</span>: userinfo.<span class="property">username</span> &#125;, secretKey, &#123; <span class="attr">expiresIn</span>: <span class="string">&#x27;30s&#x27;</span> &#125;)</span><br><span class="line">  res.<span class="title function_">send</span>(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;ç™»å½•æˆåŠŸï¼&#x27;</span>,</span><br><span class="line">    <span class="attr">token</span>: tokenStr, <span class="comment">// è¦å‘é€ç»™å®¢æˆ·ç«¯çš„ token å­—ç¬¦ä¸²</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™æ˜¯ä¸€ä¸ªæœ‰æƒé™çš„ API æ¥å£</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/admin/getinfo&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="comment">// TODO_05ï¼šä½¿ç”¨ req.user è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶ä½¿ç”¨ data å±æ€§å°†ç”¨æˆ·ä¿¡æ¯å‘é€ç»™å®¢æˆ·ç«¯</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">user</span>)</span><br><span class="line">  res.<span class="title function_">send</span>(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸï¼&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: req.<span class="property">user</span>, <span class="comment">// è¦å‘é€ç»™å®¢æˆ·ç«¯çš„ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO_06ï¼šä½¿ç”¨å…¨å±€é”™è¯¯å¤„ç†ä¸­é—´ä»¶ï¼Œæ•è·è§£æ JWT å¤±è´¥åäº§ç”Ÿçš„é”™è¯¯</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// è¿™æ¬¡é”™è¯¯æ˜¯ç”± token è§£æå¤±è´¥å¯¼è‡´çš„</span></span><br><span class="line">  <span class="keyword">if</span> (err.<span class="property">name</span> === <span class="string">&#x27;UnauthorizedError&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">send</span>(&#123;</span><br><span class="line">      <span class="attr">status</span>: <span class="number">401</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;æ— æ•ˆçš„token&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  res.<span class="title function_">send</span>(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">500</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;æœªçŸ¥çš„é”™è¯¯&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">8888</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Express server running at http://127.0.0.1:8888&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>æ’ä»¶æ–°ç‰ˆæœ¬è§£æå‡ºæ¥çš„ä¿¡æ¯å¥½åƒä¼šæŒ‚åœ¨åˆ° req.auth ä¸‹ã€‚å†™æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO_01ï¼šå®‰è£…å¹¶å¯¼å…¥ JWT ç›¸å…³çš„ä¸¤ä¸ªåŒ…ï¼Œåˆ†åˆ«æ˜¯ jsonwebtoken å’Œ express-jwt</span></span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="attr">expressjwt</span>: expressjwt &#125; = <span class="built_in">require</span>(<span class="string">&#x27;express-jwt&#x27;</span>)</span><br><span class="line"><span class="comment">// å…è®¸è·¨åŸŸèµ„æºå…±äº«</span></span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>)</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cors</span>())</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£æ post è¡¨å•æ•°æ®çš„ä¸­é—´ä»¶</span></span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>)</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO_02ï¼šå®šä¹‰ secret å¯†é’¥ï¼Œå»ºè®®å°†å¯†é’¥å‘½åä¸º secretKey</span></span><br><span class="line"><span class="keyword">const</span> secretKey = <span class="string">&#x27;i am roydon&#x27;</span></span><br><span class="line"><span class="comment">// TODO_04ï¼šæ³¨å†Œå°† JWT å­—ç¬¦ä¸²è§£æè¿˜åŸæˆ JSON å¯¹è±¡çš„ä¸­é—´ä»¶</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">expressjwt</span>(&#123; <span class="attr">secret</span>: secretKey, <span class="attr">algorithms</span>: [<span class="string">&#x27;HS256&#x27;</span>] &#125;).<span class="title function_">unless</span>(&#123; <span class="attr">path</span>: [<span class="regexp">/^\/api\//</span>] &#125;))</span><br><span class="line"><span class="comment">// ç™»å½•æ¥å£</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/api/login&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="comment">// å°† req.body è¯·æ±‚ä½“ä¸­çš„æ•°æ®ï¼Œè½¬å­˜ä¸º userinfo å¸¸é‡</span></span><br><span class="line">  <span class="keyword">const</span> userinfo = req.<span class="property">body</span></span><br><span class="line">  <span class="comment">// ç™»å½•å¤±è´¥</span></span><br><span class="line">  <span class="keyword">if</span> (userinfo.<span class="property">username</span> !== <span class="string">&#x27;roydon&#x27;</span> || userinfo.<span class="property">password</span> !== <span class="string">&#x27;roydon&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">send</span>(&#123;</span><br><span class="line">      <span class="attr">status</span>: <span class="number">400</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;ç™»å½•å¤±è´¥ï¼&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ç™»å½•æˆåŠŸ</span></span><br><span class="line">  <span class="comment">// TODO_03ï¼šåœ¨ç™»å½•æˆåŠŸä¹‹åï¼Œè°ƒç”¨ jwt.sign() æ–¹æ³•ç”Ÿæˆ JWT å­—ç¬¦ä¸²ã€‚å¹¶é€šè¿‡ token å±æ€§å‘é€ç»™å®¢æˆ·ç«¯</span></span><br><span class="line">  <span class="keyword">const</span> tokenStr = jwt.<span class="title function_">sign</span>(&#123; <span class="attr">username</span>: userinfo.<span class="property">username</span> &#125;, secretKey, &#123; <span class="attr">expiresIn</span>: <span class="string">&#x27;60s&#x27;</span> &#125;)</span><br><span class="line">  res.<span class="title function_">send</span>(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;ç™»å½•æˆåŠŸï¼&#x27;</span>,</span><br><span class="line">    <span class="attr">token</span>: tokenStr <span class="comment">// è¦å‘é€ç»™å®¢æˆ·ç«¯çš„ token å­—ç¬¦ä¸²</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™æ˜¯ä¸€ä¸ªæœ‰æƒé™çš„ API æ¥å£</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/admin/getinfo&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="comment">// TODO_05ï¼šä½¿ç”¨ req.user è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶ä½¿ç”¨ data å±æ€§å°†ç”¨æˆ·ä¿¡æ¯å‘é€ç»™å®¢æˆ·ç«¯</span></span><br><span class="line">  <span class="comment">// è·å–tokenå¤´ä¿¡æ¯å€¼+Bearer</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">auth</span>)</span><br><span class="line">  res.<span class="title function_">send</span>(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸï¼&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: req.<span class="property">auth</span> <span class="comment">// è¦å‘é€ç»™å®¢æˆ·ç«¯çš„ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO_06ï¼šä½¿ç”¨å…¨å±€é”™è¯¯å¤„ç†ä¸­é—´ä»¶ï¼Œæ•è·è§£æ JWT å¤±è´¥åäº§ç”Ÿçš„é”™è¯¯</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err.<span class="property">name</span> === <span class="string">&#x27;UnauthorizedError&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">send</span>(&#123;</span><br><span class="line">      <span class="attr">status</span>: <span class="number">401</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;æ— æ•ˆçš„token&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  res.<span class="title function_">send</span>(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">500</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;æœªçŸ¥çš„é”™è¯¯&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// è°ƒç”¨ app.listen æ–¹æ³•ï¼ŒæŒ‡å®šç«¯å£å·å¹¶å¯åŠ¨webæœåŠ¡å™¨</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">8888</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Express server running at http://127.0.0.1:8888&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>è®¿é—®ç™»å½•ç«¯å£ <a target="_blank" rel="noopener" href="http://127.0.0.1:8888/api/login">http://127.0.0.1:8888/api/login</a> å‘ç°ç”Ÿæˆäº†åŠ å¯† token<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img1.imgtp.com/2022/08/30/Yz4ncrVg.png" alt=""></p>
<p>å®¢æˆ·ç«¯æ¯æ¬¡åœ¨è®¿é—®é‚£äº›æœ‰æƒé™æ¥å£çš„æ—¶å€™ï¼Œéƒ½éœ€è¦ä¸»åŠ¨é€šè¿‡è¯·æ±‚å¤´ä¸­çš„ <strong>Authorization</strong> å­—æ®µï¼Œå°† Token å­—ç¬¦ä¸²å‘é€åˆ°æœåŠ¡å™¨è¿›è¡Œèº«ä»½è®¤è¯ã€‚</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">Authorization</th>
<th style="text-align:left">Bearer+åˆšæ‰ä¸Šå›¾ç”Ÿæˆçš„ token å­—ç¬¦ä¸²(ä¸­é—´ç©ºæ ¼éš”å¼€)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
</div>
<p>åŠ ä¸Šè¯·æ±‚å¤´è®¿é—® getinfo ç«¯å£ï¼Œå¾—åˆ°æŒ‚è½½çš„ req.auth<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img1.imgtp.com/2022/08/30/evOCZIwX.png" alt=""></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/roydonGuo">roydon</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://blog.roydon.site/posts/node.js.html">https://blog.roydon.site/posts/node.js.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://blog.roydon.site" target="_blank">roydon</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/jsonp/">jsonp</a><a class="post-meta__tags" href="/tags/cors/">cors</a><a class="post-meta__tags" href="/tags/Node-js/">Node.js</a><a class="post-meta__tags" href="/tags/session/">session</a><a class="post-meta__tags" href="/tags/JWT/">JWT</a><a class="post-meta__tags" href="/tags/%E6%9C%8D%E5%8A%A1/">æœåŠ¡</a></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2022/11/17/6375f87e21b29.png" data-sites="wechat,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> æŠ•ä¸ªå¸</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/mc-dev-3.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/11/17/6375f87f1b4c4.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Minecraftâ€”â€”Forge1.16.5æ¨¡ç»„å¼€å‘ï¼ˆ36.2.20ï¼‰â€”â€”(3)ç¬¬ä¸€ä¸ªå®ä½“æ–¹å—</div></div></a></div><div class="next-post pull-right"><a href="/posts/1e2b9fda.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/11/17/6375f87e2afa0.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">å…³äºmybatisä¸€å¯¹ä¸€æŸ¥è¯¢ï¼Œä¸€å¯¹å¤šæŸ¥è¯¢é‡åˆ°çš„é”™è¯¯</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div><div id="comment-switch"><span class="first-comment">Twikoo</span><span class="switch-btn"></span><span class="second-comment">Valine</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div><div><div class="vcomment" id="vcomment"></div></div></div><div class="comment-barrage js-pjax"></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/roydonGuo/CDN/avatar/avatar-cat.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">roydon</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">43</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">47</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">11</div></a></div><a id="card-info-btn" href="/about"><i class="iconfont icon-taiyang"></i><span>äº†è§£æ›´å¤š</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://bu.dusays.com/2022/11/17/6375f81693911.jpg" target="_blank" title="QQ"><i class="iconbrand icon-qq"></i></a><a class="social-icon" href="https://bu.dusays.com/2022/11/17/6375f816936cb.png" target="_blank" title="WeChat"><i class="iconbrand icon-wechat"></i></a><a class="social-icon" href="https://github.com/roydonGuo" target="_blank" title="Github"><i class="iconbrand icon-github"></i></a><a class="social-icon" href="https://blog.csdn.net/m0_51390535" target="_blank" title="csdn"><i class="iconbrand icon-csdn"></i></a><a class="social-icon" href="https://mail.qq.com/" target="_blank" title="Email"><i class="iconbrand icon-email"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#fs-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%A8%A1%E5%9D%97"><span class="toc-number">1.</span> <span class="toc-text">fs æ–‡ä»¶ç³»ç»Ÿæ¨¡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-fs-readFile-%E7%9A%84%E8%AF%AD%E6%B3%95%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.1.</span> <span class="toc-text">1. fs.readFile() çš„è¯­æ³•æ ¼å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-fs-writeFile-%E7%9A%84%E8%AF%AD%E6%B3%95%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.2.</span> <span class="toc-text">2. fs.writeFile() çš„è¯­æ³•æ ¼å¼</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#path-%E8%B7%AF%E5%BE%84%E6%A8%A1%E5%9D%97"><span class="toc-number">2.</span> <span class="toc-text">path è·¯å¾„æ¨¡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-path-join-%E7%9A%84%E8%AF%AD%E6%B3%95%E6%A0%BC%E5%BC%8F"><span class="toc-number">2.1.</span> <span class="toc-text">1. path.join() çš„è¯­æ³•æ ¼å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-path-basename-%E7%9A%84%E8%AF%AD%E6%B3%95%E6%A0%BC%E5%BC%8F"><span class="toc-number">2.2.</span> <span class="toc-text">2. path.basename() çš„è¯­æ³•æ ¼å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-path-extname-%E7%9A%84%E8%AF%AD%E6%B3%95%E6%A0%BC%E5%BC%8F"><span class="toc-number">2.3.</span> <span class="toc-text">3. path.extname() çš„è¯­æ³•æ ¼å¼</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#http-%E6%A8%A1%E5%9D%97"><span class="toc-number">3.</span> <span class="toc-text">http æ¨¡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E5%9F%BA%E6%9C%AC%E7%9A%84-web-%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">3.1.</span> <span class="toc-text">1.åˆ›å»ºåŸºæœ¬çš„ web æœåŠ¡å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#req-%E8%AF%B7%E6%B1%82%E5%AF%B9%E8%B1%A1"><span class="toc-number">3.1.1.</span> <span class="toc-text">req è¯·æ±‚å¯¹è±¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#res-%E5%93%8D%E5%BA%94%E5%AF%B9%E8%B1%A1"><span class="toc-number">3.1.2.</span> <span class="toc-text">res å“åº”å¯¹è±¡</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97%E5%8C%96"><span class="toc-number">4.</span> <span class="toc-text">æ¨¡å—åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%A8%A1%E5%9D%97%E5%8C%96%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">4.1.</span> <span class="toc-text">1. æ¨¡å—åŒ–çš„åŸºæœ¬æ¦‚å¿µ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-npm%E4%B8%8E%E5%8C%85"><span class="toc-number">4.2.</span> <span class="toc-text">2. npmä¸åŒ…</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Express"><span class="toc-number">5.</span> <span class="toc-text">Express</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">5.1.</span> <span class="toc-text">åŸºæœ¬ä½¿ç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Express-%E8%B7%AF%E7%94%B1"><span class="toc-number">5.2.</span> <span class="toc-text">Express è·¯ç”±</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Express-%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">5.3.</span> <span class="toc-text">Express ä¸­é—´ä»¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Express-%E5%86%99%E6%8E%A5%E5%8F%A3"><span class="toc-number">5.4.</span> <span class="toc-text">Express å†™æ¥å£</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">6.</span> <span class="toc-text">æ•°æ®åº“</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">6.1.</span> <span class="toc-text">åŸºæœ¬æ¦‚å¿µ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#node%E6%95%B4%E5%90%88mysql"><span class="toc-number">6.2.</span> <span class="toc-text">nodeæ•´åˆmysql</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E7%9A%84%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81"><span class="toc-number">7.</span> <span class="toc-text">å‰åç«¯çš„èº«ä»½è®¤è¯</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%EF%BC%9A"><span class="toc-number">7.1.</span> <span class="toc-text">èº«ä»½è®¤è¯ï¼š</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Express-%E4%BD%BF%E7%94%A8-Session-%E8%AE%A4%E8%AF%81"><span class="toc-number">7.2.</span> <span class="toc-text">Express ä½¿ç”¨ Session è®¤è¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Express-%E4%BD%BF%E7%94%A8-JWT"><span class="toc-number">7.3.</span> <span class="toc-text">Express ä½¿ç”¨ JWT</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/14e70aec.html" title="TCPä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/11/22/637ce7ce67d6a.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="TCPä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹"/></a><div class="content"><a class="title" href="/posts/14e70aec.html" title="TCPä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹">TCPä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹</a><time datetime="2023-09-03T20:03:21.000Z" title=" 2023-09-03 20:03:21">2023-09-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/8a1b0e3a.html" title="çŸ­è½®è¯¢å’Œé•¿è½®è¯¢"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/11/22/637ce7ce67d6a.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="çŸ­è½®è¯¢å’Œé•¿è½®è¯¢"/></a><div class="content"><a class="title" href="/posts/8a1b0e3a.html" title="çŸ­è½®è¯¢å’Œé•¿è½®è¯¢">çŸ­è½®è¯¢å’Œé•¿è½®è¯¢</a><time datetime="2023-09-02T20:13:10.000Z" title=" 2023-09-02 20:13:10">2023-09-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/live2d.html" title="ä¸ºhexoåšå®¢butterflyä¸»é¢˜æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰live2d"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/11/22/637ce7ce67d6a.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="ä¸ºhexoåšå®¢butterflyä¸»é¢˜æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰live2d"/></a><div class="content"><a class="title" href="/posts/live2d.html" title="ä¸ºhexoåšå®¢butterflyä¸»é¢˜æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰live2d">ä¸ºhexoåšå®¢butterflyä¸»é¢˜æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰live2d</a><time datetime="2023-07-21T17:21:20.000Z" title=" 2023-07-21 17:21:20">2023-07-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/aiwhohowwhy.html" title="AIå·¥å…·ç©¶ç«Ÿæ˜¯å¸®æ‰‹è¿˜æ˜¯å¯¹æ‰‹"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/11/22/637ce7ce67d6a.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="AIå·¥å…·ç©¶ç«Ÿæ˜¯å¸®æ‰‹è¿˜æ˜¯å¯¹æ‰‹"/></a><div class="content"><a class="title" href="/posts/aiwhohowwhy.html" title="AIå·¥å…·ç©¶ç«Ÿæ˜¯å¸®æ‰‹è¿˜æ˜¯å¯¹æ‰‹">AIå·¥å…·ç©¶ç«Ÿæ˜¯å¸®æ‰‹è¿˜æ˜¯å¯¹æ‰‹</a><time datetime="2023-04-24T22:05:38.000Z" title=" 2023-04-24 22:05:38">2023-04-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/MySQL%E7%B4%A2%E5%BC%95.html" title="MySQLç´¢å¼•"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2023/02/09/63e4ce1b46c75.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="MySQLç´¢å¼•"/></a><div class="content"><a class="title" href="/posts/MySQL%E7%B4%A2%E5%BC%95.html" title="MySQLç´¢å¼•">MySQLç´¢å¼•</a><time datetime="2023-02-11T21:57:41.000Z" title=" 2023-02-11 21:57:41">2023-02-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/MySQL%E5%9F%BA%E7%A1%80.html" title="MySQLåŸºç¡€"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2023/02/09/63e4ce1b46c75.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="MySQLåŸºç¡€"/></a><div class="content"><a class="title" href="/posts/MySQL%E5%9F%BA%E7%A1%80.html" title="MySQLåŸºç¡€">MySQLåŸºç¡€</a><time datetime="2023-02-09T18:32:45.000Z" title=" 2023-02-09 18:32:45">2023-02-09</time></div></div></div><div class="home-indicator"></div></div></div></div></main><footer id="footer"><div id="footer_deal"><a class="deal_link" href="" title="qq" target="_blank"><i class="iconbrand icon-qq"></i></a><a class="deal_link" href="" title="wechat" target="_blank"><i class="iconbrand icon-wechat"></i></a><a class="deal_link" href="" title="é‚®ä»¶" target="_blank"><i class="iconbrand icon-email"></i></a><img class="footer_mini_logo entered loading" style="border-radius:50%" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/hutao_hai.gif" onclick="btf.scrollToDest(0,500)" title="è¿”å›é¡¶éƒ¨"/><a class="deal_link" href="https://github.com/roydonGuo" title="github" target="_blank"><i class="iconbrand icon-github"></i></a><a class="deal_link" href="" title="csdn" target="_blank"><i class="iconbrand icon-csdn"></i></a><a class="deal_link" href="" title="bilibili" target="_blank"><i class="iconfont icon-bilibili"></i></a></div><div id="Jay-footer"><div class="footer-group"><h3 class="footer-title">ç›´è¾¾</h3><div class="footer-links"><a class="footer-item" href="https://roydon.xyz" target="_blank">ä¸»é¡µ</a><a class="footer-item" href="/music">éŸ³ä¹æ¬£èµ</a><a class="footer-item" href="/movies">ç”µå½±æ¬£èµ</a></div></div><div class="footer-group"><h3 class="footer-title">åˆ†ç±»</h3><div class="footer-links"><a class="footer-item" href="/categories/Android/">Android</a><a class="footer-item" href="/categories/HUAWEI/">HUAWEI</a><a class="footer-item" href="/categories/Java/">Java</a></div></div><div class="footer-group"><h3 class="footer-title">å…³äº</h3><div class="footer-links"><a class="footer-item" href="/about/">å…³äºæˆ‘</a><a class="footer-item" href="/link">å‹é“¾</a><a class="footer-item" href="/fcircle/">æœ‹å‹åœˆ</a></div></div><div class="footer-group"><h3 class="footer-title">å‹é“¾</h3><div class="footer-links" id="friend-links-in-footer"></div></div></div><div id="footer-banner"><div class="footer-banner-links"><div class="footer-banner-left"><div class="footer-banner-left"><div id="footer-banner-tips"></div><script src="https://cdn.jsdelivr.net/npm/typed.js/lib/typed.min.js"></script><script>var typed = new Typed("#footer-banner-tips", {
  strings: ["å¸Œæœ›ä½ æ‰€åšçš„ï¼Œèƒ½æ¢æ¥ä½ æ‰€æƒ³æ‹¥æœ‰çš„ä¸€åˆ‡ã€‚", "it's a common saying that man who has a sattled purpose will surelly succeed."],
  startDelay: 200,
  backDelay: 2000,
  typeSpeed: 100,
  loop: true,
  backSpeed: 20
})
</script></div></div><div class="footer-banner-right"><a class="footer-banner-link" target="_blank" rel="noopener" href="https://hexo.io/zh-cn/" title="Hexo">æ¡†æ¶</a><a class="footer-banner-link">|</a><a class="footer-banner-link" target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly" title="theme">ä¸»é¢˜</a><a class="footer-banner-link">|</a><a class="footer-banner-link" href="/about/" title="about">å…³äº</a></div></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="èŠå¤©"><i class="iconfont icon-kaixin"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="iconfont icon-bibi"></i></a><a id="switch_commentBarrage" href="javascript:switchCommentBarrage();" title="å¼€å…³å¼¹å¹•"><i class="iconfont icon-danmu"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div><script src="https://npm.elemecdn.com/vue@2.6.14"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/vanilla-lazyload/17.3.1/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/algoliasearch-lite.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.roydon.site',
      region: '',
      onCommentLoaded: function () {
        if (location.pathname == '/comments/') addDanmaku();
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.roydon.site',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'n5bJDnhkFDPpUxlHphl01Fa6-gzGzoHsz',
      appKey: 'N6dnp2zcXFvTon5Emp0cG3Nm',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Twikoo' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[å›¾ç‰‡]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[é“¾æ¥]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[ä»£ç ]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo.roydon.site',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.innerHTML= "æ— æ³•è·å–è¯„è®ºï¼Œè¯·ç¡®è®¤ç›¸å…³é…ç½®æ˜¯å¦æ­£ç¡®"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += 'æ²¡æœ‰è¯„è®º'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script src="https://sdk.51.la/perf/js-sdk-perf.min.js" crossorigin="anonymous"></script><script>LA.init({id:"JsTC3BXZ3pFkbT8s",ck:"JsTC3BXZ3pFkbT8s"})</script><script>new LingQue.Monitor().init({id:"JsTC3BXZ3pFkbT8s",sendSuspicious:true});</script><script async pace-options='{ "restartOnRequestAfter":false,"eventLag":false}' src="https://cdn.jsdelivr.net/npm/pace-js@latest/pace.min.js"></script><script defer src="https://unpkg.com/swiper@8/swiper-bundle.min.js"> </script><script defer src="https://npm.elemecdn.com/echarts@4.9.0/dist/echarts.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script><script defer src="https://unpkg.com/element-ui/lib/index.js"></script><script defer src="//cdn.jsdelivr.net/npm/leancloud-storage@4.0.0/dist/av-min.js"></script><script defer src="/js/spine.js"></script><canvas id="universe"></canvas><script defer src="https://cdn.jsdelivr.net/gh/nextapps-de/winbox/dist/winbox.bundle.min.js"></script><script async src="/roydon/random.js"></script><script defer src="/js/function.js"></script><script defer src="/js/roydon.js"></script><script defer src="/js/dianzan.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="true" data-text="å¯Œå¼º,æ°‘ä¸»,æ–‡æ˜,å’Œè°,è‡ªç”±,å¹³ç­‰,å…¬æ­£,æ³•åˆ¶,çˆ±å›½,æ•¬ä¸š,è¯šä¿¡,å‹å–„" data-fontsize="14px" data-random="true" async="async"></script><script src="//code.tidio.co/z0lx6wwsfanr2xuagzl5gsszkidfuv2g.js" async="async"></script><script>function onTidioChatApiReady() {
  window.tidioChatApi.hide();
  window.tidioChatApi.on("close", function() {
    window.tidioChatApi.hide();
  });
}
if (window.tidioChatApi) {
  window.tidioChatApi.on("ready", onTidioChatApiReady);
} else {
  document.addEventListener("tidioChat-ready", onTidioChatApiReady);
}

var chatBtnFn = () => {
  document.getElementById("chat_btn").addEventListener("click", function(){
    window.tidioChatApi.show();
    window.tidioChatApi.open();
  });
}
chatBtnFn()
</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://roydon-blog.oss-cn-shanghai.aliyuncs.com/js/Meting2.min.js"></script><script src="https://lib.baomitu.com/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show","#web_bg",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,

  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"

  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script async src="//at.alicdn.com/t/c/font_3603575_qwu8r542qo9.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '500ms');
    arr[i].setAttribute('data-wow-delay', '50ms');
    arr[i].setAttribute('data-wow-offset', '100');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '500ms');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('flink-list-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__flipInY');
    arr[i].setAttribute('data-wow-duration', '500ms');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('categoryBar-list-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '500ms');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('site-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__flipInY');
    arr[i].setAttribute('data-wow-duration', '500ms');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('movies-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '500ms');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('essay-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '500ms');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow_init.js"></script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"scale":1,"jsonPath":"/live2dw/assets/remu.model.json"},"display":{"width":270,"height":540,"position":"left","hOffset":0,"vOffset":-105},"dialog":{"enable":false,"hitokoto":false},"mobile":{"show":false,"scale":0.5},"react":{"opacity":1},"log":false});</script></body></html>